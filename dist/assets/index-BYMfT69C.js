(function(){const y=document.createElement("link").relList;if(y&&y.supports&&y.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))w(l);new MutationObserver(l=>{for(const e of l)if(e.type==="childList")for(const r of e.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&w(r)}).observe(document,{childList:!0,subtree:!0});function p(l){const e={};return l.integrity&&(e.integrity=l.integrity),l.referrerPolicy&&(e.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?e.credentials="include":l.crossOrigin==="anonymous"?e.credentials="omit":e.credentials="same-origin",e}function w(l){if(l.ep)return;l.ep=!0;const e=p(l);fetch(l.href,e)}})();function Be(){return{clockDisplayArea:document.getElementById("clock-display-area"),timeEl:document.getElementById("time"),dateEl:document.getElementById("date"),scheduleCirclesDisplayEl:document.getElementById("schedule-circles-display"),periodContainerEl:document.getElementById("period-container"),periodLabelEl:document.getElementById("period-label"),progressBarEl:document.getElementById("progress-bar"),progressEl:document.getElementById("progress"),timeLeftEl:document.getElementById("time-left"),sandBarsContainerEl:document.getElementById("sand-bars-container"),sandBarsCanvas:document.getElementById("sand-bars-canvas"),alertModal:document.getElementById("alert-modal"),alertModalTitle:document.getElementById("modal-title"),alertModalBody:document.getElementById("modal-body"),closeModalBtn:document.querySelector("#alert-modal .close-modal-btn"),menuToggle:document.getElementById("menu-toggle"),settingsMenu:document.getElementById("settings-menu"),menuResizer:document.getElementById("menu-resizer"),settingsNav:document.getElementById("settings-nav"),tabsContainer:document.getElementById("tabs"),tabContentsContainer:document.getElementById("tab-contents"),appearanceTab:document.getElementById("appearance-tab"),scheduleAlertsTab:document.getElementById("schedule-alerts-tab"),displayElementsChecklist:document.getElementById("display-elements-checklist"),fontSelect:document.getElementById("pref-font"),dateFontSizeInput:document.getElementById("pref-date-font"),timeFontSizeInput:document.getElementById("pref-time-font"),labelFontSizeInput:document.getElementById("pref-schedule-label-font"),timeLeftFontSizeInput:document.getElementById("pref-time-left-font"),progressHeightInput:document.getElementById("pref-progress-height"),resetAppearanceBtn:document.getElementById("reset-appearance-defaults"),resetSchemesBtn:document.getElementById("reset-schemes-defaults"),colorSchemeTabsContainer:document.getElementById("colour-scheme-tabs"),colorSchemeContentContainer:document.getElementById("colour-scheme-content"),scheduleTableBody:document.querySelector("#schedule-table tbody"),addScheduleRowBtn:document.getElementById("add-schedule-row"),deleteScheduleRowBtn:document.getElementById("delete-schedule-row"),timeSyncSection:document.getElementById("time-sync-section"),syncToBellBtn:document.getElementById("sync-to-bell"),offsetMinDownBtn:document.getElementById("offset-min-down"),offsetMinUpBtn:document.getElementById("offset-min-up"),offsetSecDownBtn:document.getElementById("offset-sec-down"),offsetSecUpBtn:document.getElementById("offset-sec-up"),resetOffsetBtn:document.getElementById("reset-offset"),currentOffsetDisplay:document.getElementById("current-offset")}}let T={};function Le(){T=Be(),console.log("DOM Cache Updated",T)}const J={getTodayTime:function(g){if(!g||!/^\d{2}:\d{2}$/.test(g)){const l=new Date;return l.setSeconds(0,0),l}const[y,p]=g.split(":").map(Number),w=new Date;return w.setHours(y,p,0,0),w},formatTime:function(g){let y=g.getHours();const p=g.getMinutes(),w=y>=12?"PM":"AM";return y=y%12||12,`${y}:${p<10?"0"+p:p} ${w}`},formatDate:function(g){const y={weekday:"long",month:"long",day:"numeric"};return g.toLocaleDateString(void 0,y)},showFeedback:function(g,y,p=!0){g&&(g.textContent=y,g.classList.remove("success","error"),g.classList.add(p?"success":"error"),g.style.display="block",setTimeout(()=>{g&&(g.style.display="none")},3e3))},showButtonFeedback:function(g,y="Saved!",p=1500){if(!g)return;const w=g.textContent;g.textContent=y,g.classList.add("button-success"),g.disabled=!0,setTimeout(()=>{g&&(g.textContent=w,g.classList.remove("button-success"),g.disabled=!1)},p)},lightenColor:function(g,y){if(!g||(g=g.replace(/^#/,""),g.length!==6))return"#cccccc";try{let p=parseInt(g.substring(0,2),16),w=parseInt(g.substring(2,4),16),l=parseInt(g.substring(4,6),16);p=Math.min(255,Math.floor(p*(1+y/100))),w=Math.min(255,Math.floor(w*(1+y/100))),l=Math.min(255,Math.floor(l*(1+y/100)));const e=p.toString(16).padStart(2,"0"),r=w.toString(16).padStart(2,"0"),n=l.toString(16).padStart(2,"0");return`#${e}${r}${n}`}catch(p){return console.error("Error lightening color:",g,p),"#cccccc"}}};function se(){const g=S.preferences&&S.preferences.timeOffsetMs?Number(S.preferences.timeOffsetMs):0,y=new Date;return new Date(y.getTime()+g)}const R={currentPeriodLabel:null,currentPeriodIndex:null,activeVisualAlertInterval:null,activeVisualAlertTimeout:null,originalBodyStyles:{},selectedScheduleRowIndex:null,isResizingMenu:!1,dragStartIndex:null,SAND_COLORS:["#fba1bd","#dfb37a","#8aca91","#54cce2","#b6b6fd"],physicsCheckIntervalId:null,physicsCheckIntervalMs:100,physicsParticlesAdded:0,totalParticlesForPeriod:0};var he=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Te(g){return g&&g.__esModule&&Object.prototype.hasOwnProperty.call(g,"default")?g.default:g}var Ce={exports:{}};/*!
 * matter-js 0.19.0 by @liabru
 * http://brm.io/matter-js/
 * License MIT
 * 
 * The MIT License (MIT)
 * 
 * Copyright (c) Liam Brummitt and contributors.
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */(function(g,y){(function(w,l){g.exports=l()})(he,function(){return function(p){var w={};function l(e){if(w[e])return w[e].exports;var r=w[e]={i:e,l:!1,exports:{}};return p[e].call(r.exports,r,r.exports,l),r.l=!0,r.exports}return l.m=p,l.c=w,l.d=function(e,r,n){l.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:n})},l.r=function(e){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},l.t=function(e,r){if(r&1&&(e=l(e)),r&8||r&4&&typeof e=="object"&&e&&e.__esModule)return e;var n=Object.create(null);if(l.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),r&2&&typeof e!="string")for(var s in e)l.d(n,s,(function(f){return e[f]}).bind(null,s));return n},l.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return l.d(r,"a",r),r},l.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},l.p="",l(l.s=20)}([function(p,w){var l={};p.exports=l,function(){l._baseDelta=1e3/60,l._nextId=0,l._seed=0,l._nowStartTime=+new Date,l._warnedOnce={},l._decomp=null,l.extend=function(r,n){var s,f;typeof n=="boolean"?(s=2,f=n):(s=1,f=!0);for(var c=s;c<arguments.length;c++){var u=arguments[c];if(u)for(var o in u)f&&u[o]&&u[o].constructor===Object&&(!r[o]||r[o].constructor===Object)?(r[o]=r[o]||{},l.extend(r[o],f,u[o])):r[o]=u[o]}return r},l.clone=function(r,n){return l.extend({},n,r)},l.keys=function(r){if(Object.keys)return Object.keys(r);var n=[];for(var s in r)n.push(s);return n},l.values=function(r){var n=[];if(Object.keys){for(var s=Object.keys(r),f=0;f<s.length;f++)n.push(r[s[f]]);return n}for(var c in r)n.push(r[c]);return n},l.get=function(r,n,s,f){n=n.split(".").slice(s,f);for(var c=0;c<n.length;c+=1)r=r[n[c]];return r},l.set=function(r,n,s,f,c){var u=n.split(".").slice(f,c);return l.get(r,n,0,-1)[u[u.length-1]]=s,s},l.shuffle=function(r){for(var n=r.length-1;n>0;n--){var s=Math.floor(l.random()*(n+1)),f=r[n];r[n]=r[s],r[s]=f}return r},l.choose=function(r){return r[Math.floor(l.random()*r.length)]},l.isElement=function(r){return typeof HTMLElement<"u"?r instanceof HTMLElement:!!(r&&r.nodeType&&r.nodeName)},l.isArray=function(r){return Object.prototype.toString.call(r)==="[object Array]"},l.isFunction=function(r){return typeof r=="function"},l.isPlainObject=function(r){return typeof r=="object"&&r.constructor===Object},l.isString=function(r){return toString.call(r)==="[object String]"},l.clamp=function(r,n,s){return r<n?n:r>s?s:r},l.sign=function(r){return r<0?-1:1},l.now=function(){if(typeof window<"u"&&window.performance){if(window.performance.now)return window.performance.now();if(window.performance.webkitNow)return window.performance.webkitNow()}return Date.now?Date.now():new Date-l._nowStartTime},l.random=function(r,n){return r=typeof r<"u"?r:0,n=typeof n<"u"?n:1,r+e()*(n-r)};var e=function(){return l._seed=(l._seed*9301+49297)%233280,l._seed/233280};l.colorToNumber=function(r){return r=r.replace("#",""),r.length==3&&(r=r.charAt(0)+r.charAt(0)+r.charAt(1)+r.charAt(1)+r.charAt(2)+r.charAt(2)),parseInt(r,16)},l.logLevel=1,l.log=function(){console&&l.logLevel>0&&l.logLevel<=3&&console.log.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},l.info=function(){console&&l.logLevel>0&&l.logLevel<=2&&console.info.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},l.warn=function(){console&&l.logLevel>0&&l.logLevel<=3&&console.warn.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},l.warnOnce=function(){var r=Array.prototype.slice.call(arguments).join(" ");l._warnedOnce[r]||(l.warn(r),l._warnedOnce[r]=!0)},l.deprecated=function(r,n,s){r[n]=l.chain(function(){l.warnOnce("🔅 deprecated 🔅",s)},r[n])},l.nextId=function(){return l._nextId++},l.indexOf=function(r,n){if(r.indexOf)return r.indexOf(n);for(var s=0;s<r.length;s++)if(r[s]===n)return s;return-1},l.map=function(r,n){if(r.map)return r.map(n);for(var s=[],f=0;f<r.length;f+=1)s.push(n(r[f]));return s},l.topologicalSort=function(r){var n=[],s=[],f=[];for(var c in r)!s[c]&&!f[c]&&l._topologicalSort(c,s,f,r,n);return n},l._topologicalSort=function(r,n,s,f,c){var u=f[r]||[];s[r]=!0;for(var o=0;o<u.length;o+=1){var t=u[o];s[t]||n[t]||l._topologicalSort(t,n,s,f,c)}s[r]=!1,n[r]=!0,c.push(r)},l.chain=function(){for(var r=[],n=0;n<arguments.length;n+=1){var s=arguments[n];s._chained?r.push.apply(r,s._chained):r.push(s)}var f=function(){for(var c,u=new Array(arguments.length),o=0,t=arguments.length;o<t;o++)u[o]=arguments[o];for(o=0;o<r.length;o+=1){var i=r[o].apply(c,u);typeof i<"u"&&(c=i)}return c};return f._chained=r,f},l.chainPathBefore=function(r,n,s){return l.set(r,n,l.chain(s,l.get(r,n)))},l.chainPathAfter=function(r,n,s){return l.set(r,n,l.chain(l.get(r,n),s))},l.setDecomp=function(r){l._decomp=r},l.getDecomp=function(){var r=l._decomp;try{!r&&typeof window<"u"&&(r=window.decomp),!r&&typeof he<"u"&&(r=he.decomp)}catch{r=null}return r}}()},function(p,w){var l={};p.exports=l,function(){l.create=function(e){var r={min:{x:0,y:0},max:{x:0,y:0}};return e&&l.update(r,e),r},l.update=function(e,r,n){e.min.x=1/0,e.max.x=-1/0,e.min.y=1/0,e.max.y=-1/0;for(var s=0;s<r.length;s++){var f=r[s];f.x>e.max.x&&(e.max.x=f.x),f.x<e.min.x&&(e.min.x=f.x),f.y>e.max.y&&(e.max.y=f.y),f.y<e.min.y&&(e.min.y=f.y)}n&&(n.x>0?e.max.x+=n.x:e.min.x+=n.x,n.y>0?e.max.y+=n.y:e.min.y+=n.y)},l.contains=function(e,r){return r.x>=e.min.x&&r.x<=e.max.x&&r.y>=e.min.y&&r.y<=e.max.y},l.overlaps=function(e,r){return e.min.x<=r.max.x&&e.max.x>=r.min.x&&e.max.y>=r.min.y&&e.min.y<=r.max.y},l.translate=function(e,r){e.min.x+=r.x,e.max.x+=r.x,e.min.y+=r.y,e.max.y+=r.y},l.shift=function(e,r){var n=e.max.x-e.min.x,s=e.max.y-e.min.y;e.min.x=r.x,e.max.x=r.x+n,e.min.y=r.y,e.max.y=r.y+s}}()},function(p,w){var l={};p.exports=l,function(){l.create=function(e,r){return{x:e||0,y:r||0}},l.clone=function(e){return{x:e.x,y:e.y}},l.magnitude=function(e){return Math.sqrt(e.x*e.x+e.y*e.y)},l.magnitudeSquared=function(e){return e.x*e.x+e.y*e.y},l.rotate=function(e,r,n){var s=Math.cos(r),f=Math.sin(r);n||(n={});var c=e.x*s-e.y*f;return n.y=e.x*f+e.y*s,n.x=c,n},l.rotateAbout=function(e,r,n,s){var f=Math.cos(r),c=Math.sin(r);s||(s={});var u=n.x+((e.x-n.x)*f-(e.y-n.y)*c);return s.y=n.y+((e.x-n.x)*c+(e.y-n.y)*f),s.x=u,s},l.normalise=function(e){var r=l.magnitude(e);return r===0?{x:0,y:0}:{x:e.x/r,y:e.y/r}},l.dot=function(e,r){return e.x*r.x+e.y*r.y},l.cross=function(e,r){return e.x*r.y-e.y*r.x},l.cross3=function(e,r,n){return(r.x-e.x)*(n.y-e.y)-(r.y-e.y)*(n.x-e.x)},l.add=function(e,r,n){return n||(n={}),n.x=e.x+r.x,n.y=e.y+r.y,n},l.sub=function(e,r,n){return n||(n={}),n.x=e.x-r.x,n.y=e.y-r.y,n},l.mult=function(e,r){return{x:e.x*r,y:e.y*r}},l.div=function(e,r){return{x:e.x/r,y:e.y/r}},l.perp=function(e,r){return r=r===!0?-1:1,{x:r*-e.y,y:r*e.x}},l.neg=function(e){return{x:-e.x,y:-e.y}},l.angle=function(e,r){return Math.atan2(r.y-e.y,r.x-e.x)},l._temp=[l.create(),l.create(),l.create(),l.create(),l.create(),l.create()]}()},function(p,w,l){var e={};p.exports=e;var r=l(2),n=l(0);(function(){e.create=function(s,f){for(var c=[],u=0;u<s.length;u++){var o=s[u],t={x:o.x,y:o.y,index:u,body:f,isInternal:!1};c.push(t)}return c},e.fromPath=function(s,f){var c=/L?\s*([-\d.e]+)[\s,]*([-\d.e]+)*/ig,u=[];return s.replace(c,function(o,t,i){u.push({x:parseFloat(t),y:parseFloat(i)})}),e.create(u,f)},e.centre=function(s){for(var f=e.area(s,!0),c={x:0,y:0},u,o,t,i=0;i<s.length;i++)t=(i+1)%s.length,u=r.cross(s[i],s[t]),o=r.mult(r.add(s[i],s[t]),u),c=r.add(c,o);return r.div(c,6*f)},e.mean=function(s){for(var f={x:0,y:0},c=0;c<s.length;c++)f.x+=s[c].x,f.y+=s[c].y;return r.div(f,s.length)},e.area=function(s,f){for(var c=0,u=s.length-1,o=0;o<s.length;o++)c+=(s[u].x-s[o].x)*(s[u].y+s[o].y),u=o;return f?c/2:Math.abs(c)/2},e.inertia=function(s,f){for(var c=0,u=0,o=s,t,i,a=0;a<o.length;a++)i=(a+1)%o.length,t=Math.abs(r.cross(o[i],o[a])),c+=t*(r.dot(o[i],o[i])+r.dot(o[i],o[a])+r.dot(o[a],o[a])),u+=t;return f/6*(c/u)},e.translate=function(s,f,c){c=typeof c<"u"?c:1;var u=s.length,o=f.x*c,t=f.y*c,i;for(i=0;i<u;i++)s[i].x+=o,s[i].y+=t;return s},e.rotate=function(s,f,c){if(f!==0){var u=Math.cos(f),o=Math.sin(f),t=c.x,i=c.y,a=s.length,d,m,P,E;for(E=0;E<a;E++)d=s[E],m=d.x-t,P=d.y-i,d.x=t+(m*u-P*o),d.y=i+(m*o+P*u);return s}},e.contains=function(s,f){for(var c=f.x,u=f.y,o=s.length,t=s[o-1],i,a=0;a<o;a++){if(i=s[a],(c-t.x)*(i.y-t.y)+(u-t.y)*(t.x-i.x)>0)return!1;t=i}return!0},e.scale=function(s,f,c,u){if(f===1&&c===1)return s;u=u||e.centre(s);for(var o,t,i=0;i<s.length;i++)o=s[i],t=r.sub(o,u),s[i].x=u.x+t.x*f,s[i].y=u.y+t.y*c;return s},e.chamfer=function(s,f,c,u,o){typeof f=="number"?f=[f]:f=f||[8],c=typeof c<"u"?c:-1,u=u||2,o=o||14;for(var t=[],i=0;i<s.length;i++){var a=s[i-1>=0?i-1:s.length-1],d=s[i],m=s[(i+1)%s.length],P=f[i<f.length?i:f.length-1];if(P===0){t.push(d);continue}var E=r.normalise({x:d.y-a.y,y:a.x-d.x}),B=r.normalise({x:m.y-d.y,y:d.x-m.x}),h=Math.sqrt(2*Math.pow(P,2)),x=r.mult(n.clone(E),P),C=r.normalise(r.mult(r.add(E,B),.5)),v=r.sub(d,r.mult(C,h)),M=c;c===-1&&(M=Math.pow(P,.32)*1.75),M=n.clamp(M,u,o),M%2===1&&(M+=1);for(var I=Math.acos(r.dot(E,B)),b=I/M,L=0;L<M;L++)t.push(r.add(r.rotate(x,b*L),v))}return t},e.clockwiseSort=function(s){var f=e.mean(s);return s.sort(function(c,u){return r.angle(f,c)-r.angle(f,u)}),s},e.isConvex=function(s){var f=0,c=s.length,u,o,t,i;if(c<3)return null;for(u=0;u<c;u++)if(o=(u+1)%c,t=(u+2)%c,i=(s[o].x-s[u].x)*(s[t].y-s[o].y),i-=(s[o].y-s[u].y)*(s[t].x-s[o].x),i<0?f|=1:i>0&&(f|=2),f===3)return!1;return f!==0?!0:null},e.hull=function(s){var f=[],c=[],u,o;for(s=s.slice(0),s.sort(function(t,i){var a=t.x-i.x;return a!==0?a:t.y-i.y}),o=0;o<s.length;o+=1){for(u=s[o];c.length>=2&&r.cross3(c[c.length-2],c[c.length-1],u)<=0;)c.pop();c.push(u)}for(o=s.length-1;o>=0;o-=1){for(u=s[o];f.length>=2&&r.cross3(f[f.length-2],f[f.length-1],u)<=0;)f.pop();f.push(u)}return f.pop(),c.pop(),f.concat(c)}})()},function(p,w,l){var e={};p.exports=e;var r=l(3),n=l(2),s=l(7),f=l(0),c=l(1),u=l(11);(function(){e._timeCorrection=!0,e._inertiaScale=4,e._nextCollidingGroupId=1,e._nextNonCollidingGroupId=-1,e._nextCategory=1,e._baseDelta=1e3/60,e.create=function(t){var i={id:f.nextId(),type:"body",label:"Body",parts:[],plugin:{},angle:0,vertices:r.fromPath("L 0 0 L 40 0 L 40 40 L 0 40"),position:{x:0,y:0},force:{x:0,y:0},torque:0,positionImpulse:{x:0,y:0},constraintImpulse:{x:0,y:0,angle:0},totalContacts:0,speed:0,angularSpeed:0,velocity:{x:0,y:0},angularVelocity:0,isSensor:!1,isStatic:!1,isSleeping:!1,motion:0,sleepThreshold:60,density:.001,restitution:0,friction:.1,frictionStatic:.5,frictionAir:.01,collisionFilter:{category:1,mask:4294967295,group:0},slop:.05,timeScale:1,render:{visible:!0,opacity:1,strokeStyle:null,fillStyle:null,lineWidth:null,sprite:{xScale:1,yScale:1,xOffset:0,yOffset:0}},events:null,bounds:null,chamfer:null,circleRadius:0,positionPrev:null,anglePrev:0,parent:null,axes:null,area:0,mass:0,inertia:0,deltaTime:16.666666666666668,_original:null},a=f.extend(i,t);return o(a,t),a},e.nextGroup=function(t){return t?e._nextNonCollidingGroupId--:e._nextCollidingGroupId++},e.nextCategory=function(){return e._nextCategory=e._nextCategory<<1,e._nextCategory};var o=function(t,i){i=i||{},e.set(t,{bounds:t.bounds||c.create(t.vertices),positionPrev:t.positionPrev||n.clone(t.position),anglePrev:t.anglePrev||t.angle,vertices:t.vertices,parts:t.parts||[t],isStatic:t.isStatic,isSleeping:t.isSleeping,parent:t.parent||t}),r.rotate(t.vertices,t.angle,t.position),u.rotate(t.axes,t.angle),c.update(t.bounds,t.vertices,t.velocity),e.set(t,{axes:i.axes||t.axes,area:i.area||t.area,mass:i.mass||t.mass,inertia:i.inertia||t.inertia});var a=t.isStatic?"#14151f":f.choose(["#f19648","#f5d259","#f55a3c","#063e7b","#ececd1"]),d=t.isStatic?"#555":"#ccc",m=t.isStatic&&t.render.fillStyle===null?1:0;t.render.fillStyle=t.render.fillStyle||a,t.render.strokeStyle=t.render.strokeStyle||d,t.render.lineWidth=t.render.lineWidth||m,t.render.sprite.xOffset+=-(t.bounds.min.x-t.position.x)/(t.bounds.max.x-t.bounds.min.x),t.render.sprite.yOffset+=-(t.bounds.min.y-t.position.y)/(t.bounds.max.y-t.bounds.min.y)};e.set=function(t,i,a){var d;typeof i=="string"&&(d=i,i={},i[d]=a);for(d in i)if(Object.prototype.hasOwnProperty.call(i,d))switch(a=i[d],d){case"isStatic":e.setStatic(t,a);break;case"isSleeping":s.set(t,a);break;case"mass":e.setMass(t,a);break;case"density":e.setDensity(t,a);break;case"inertia":e.setInertia(t,a);break;case"vertices":e.setVertices(t,a);break;case"position":e.setPosition(t,a);break;case"angle":e.setAngle(t,a);break;case"velocity":e.setVelocity(t,a);break;case"angularVelocity":e.setAngularVelocity(t,a);break;case"speed":e.setSpeed(t,a);break;case"angularSpeed":e.setAngularSpeed(t,a);break;case"parts":e.setParts(t,a);break;case"centre":e.setCentre(t,a);break;default:t[d]=a}},e.setStatic=function(t,i){for(var a=0;a<t.parts.length;a++){var d=t.parts[a];d.isStatic=i,i?(d._original={restitution:d.restitution,friction:d.friction,mass:d.mass,inertia:d.inertia,density:d.density,inverseMass:d.inverseMass,inverseInertia:d.inverseInertia},d.restitution=0,d.friction=1,d.mass=d.inertia=d.density=1/0,d.inverseMass=d.inverseInertia=0,d.positionPrev.x=d.position.x,d.positionPrev.y=d.position.y,d.anglePrev=d.angle,d.angularVelocity=0,d.speed=0,d.angularSpeed=0,d.motion=0):d._original&&(d.restitution=d._original.restitution,d.friction=d._original.friction,d.mass=d._original.mass,d.inertia=d._original.inertia,d.density=d._original.density,d.inverseMass=d._original.inverseMass,d.inverseInertia=d._original.inverseInertia,d._original=null)}},e.setMass=function(t,i){var a=t.inertia/(t.mass/6);t.inertia=a*(i/6),t.inverseInertia=1/t.inertia,t.mass=i,t.inverseMass=1/t.mass,t.density=t.mass/t.area},e.setDensity=function(t,i){e.setMass(t,i*t.area),t.density=i},e.setInertia=function(t,i){t.inertia=i,t.inverseInertia=1/t.inertia},e.setVertices=function(t,i){i[0].body===t?t.vertices=i:t.vertices=r.create(i,t),t.axes=u.fromVertices(t.vertices),t.area=r.area(t.vertices),e.setMass(t,t.density*t.area);var a=r.centre(t.vertices);r.translate(t.vertices,a,-1),e.setInertia(t,e._inertiaScale*r.inertia(t.vertices,t.mass)),r.translate(t.vertices,t.position),c.update(t.bounds,t.vertices,t.velocity)},e.setParts=function(t,i,a){var d;for(i=i.slice(0),t.parts.length=0,t.parts.push(t),t.parent=t,d=0;d<i.length;d++){var m=i[d];m!==t&&(m.parent=t,t.parts.push(m))}if(t.parts.length!==1){if(a=typeof a<"u"?a:!0,a){var P=[];for(d=0;d<i.length;d++)P=P.concat(i[d].vertices);r.clockwiseSort(P);var E=r.hull(P),B=r.centre(E);e.setVertices(t,E),r.translate(t.vertices,B)}var h=e._totalProperties(t);t.area=h.area,t.parent=t,t.position.x=h.centre.x,t.position.y=h.centre.y,t.positionPrev.x=h.centre.x,t.positionPrev.y=h.centre.y,e.setMass(t,h.mass),e.setInertia(t,h.inertia),e.setPosition(t,h.centre)}},e.setCentre=function(t,i,a){a?(t.positionPrev.x+=i.x,t.positionPrev.y+=i.y,t.position.x+=i.x,t.position.y+=i.y):(t.positionPrev.x=i.x-(t.position.x-t.positionPrev.x),t.positionPrev.y=i.y-(t.position.y-t.positionPrev.y),t.position.x=i.x,t.position.y=i.y)},e.setPosition=function(t,i,a){var d=n.sub(i,t.position);a?(t.positionPrev.x=t.position.x,t.positionPrev.y=t.position.y,t.velocity.x=d.x,t.velocity.y=d.y,t.speed=n.magnitude(d)):(t.positionPrev.x+=d.x,t.positionPrev.y+=d.y);for(var m=0;m<t.parts.length;m++){var P=t.parts[m];P.position.x+=d.x,P.position.y+=d.y,r.translate(P.vertices,d),c.update(P.bounds,P.vertices,t.velocity)}},e.setAngle=function(t,i,a){var d=i-t.angle;a?(t.anglePrev=t.angle,t.angularVelocity=d,t.angularSpeed=Math.abs(d)):t.anglePrev+=d;for(var m=0;m<t.parts.length;m++){var P=t.parts[m];P.angle+=d,r.rotate(P.vertices,d,t.position),u.rotate(P.axes,d),c.update(P.bounds,P.vertices,t.velocity),m>0&&n.rotateAbout(P.position,d,t.position,P.position)}},e.setVelocity=function(t,i){var a=t.deltaTime/e._baseDelta;t.positionPrev.x=t.position.x-i.x*a,t.positionPrev.y=t.position.y-i.y*a,t.velocity.x=(t.position.x-t.positionPrev.x)/a,t.velocity.y=(t.position.y-t.positionPrev.y)/a,t.speed=n.magnitude(t.velocity)},e.getVelocity=function(t){var i=e._baseDelta/t.deltaTime;return{x:(t.position.x-t.positionPrev.x)*i,y:(t.position.y-t.positionPrev.y)*i}},e.getSpeed=function(t){return n.magnitude(e.getVelocity(t))},e.setSpeed=function(t,i){e.setVelocity(t,n.mult(n.normalise(e.getVelocity(t)),i))},e.setAngularVelocity=function(t,i){var a=t.deltaTime/e._baseDelta;t.anglePrev=t.angle-i*a,t.angularVelocity=(t.angle-t.anglePrev)/a,t.angularSpeed=Math.abs(t.angularVelocity)},e.getAngularVelocity=function(t){return(t.angle-t.anglePrev)*e._baseDelta/t.deltaTime},e.getAngularSpeed=function(t){return Math.abs(e.getAngularVelocity(t))},e.setAngularSpeed=function(t,i){e.setAngularVelocity(t,f.sign(e.getAngularVelocity(t))*i)},e.translate=function(t,i,a){e.setPosition(t,n.add(t.position,i),a)},e.rotate=function(t,i,a,d){if(!a)e.setAngle(t,t.angle+i,d);else{var m=Math.cos(i),P=Math.sin(i),E=t.position.x-a.x,B=t.position.y-a.y;e.setPosition(t,{x:a.x+(E*m-B*P),y:a.y+(E*P+B*m)},d),e.setAngle(t,t.angle+i,d)}},e.scale=function(t,i,a,d){var m=0,P=0;d=d||t.position;for(var E=0;E<t.parts.length;E++){var B=t.parts[E];r.scale(B.vertices,i,a,d),B.axes=u.fromVertices(B.vertices),B.area=r.area(B.vertices),e.setMass(B,t.density*B.area),r.translate(B.vertices,{x:-B.position.x,y:-B.position.y}),e.setInertia(B,e._inertiaScale*r.inertia(B.vertices,B.mass)),r.translate(B.vertices,{x:B.position.x,y:B.position.y}),E>0&&(m+=B.area,P+=B.inertia),B.position.x=d.x+(B.position.x-d.x)*i,B.position.y=d.y+(B.position.y-d.y)*a,c.update(B.bounds,B.vertices,t.velocity)}t.parts.length>1&&(t.area=m,t.isStatic||(e.setMass(t,t.density*m),e.setInertia(t,P))),t.circleRadius&&(i===a?t.circleRadius*=i:t.circleRadius=null)},e.update=function(t,i){i=(typeof i<"u"?i:1e3/60)*t.timeScale;var a=i*i,d=e._timeCorrection?i/(t.deltaTime||i):1,m=1-t.frictionAir*(i/f._baseDelta),P=(t.position.x-t.positionPrev.x)*d,E=(t.position.y-t.positionPrev.y)*d;t.velocity.x=P*m+t.force.x/t.mass*a,t.velocity.y=E*m+t.force.y/t.mass*a,t.positionPrev.x=t.position.x,t.positionPrev.y=t.position.y,t.position.x+=t.velocity.x,t.position.y+=t.velocity.y,t.deltaTime=i,t.angularVelocity=(t.angle-t.anglePrev)*m*d+t.torque/t.inertia*a,t.anglePrev=t.angle,t.angle+=t.angularVelocity;for(var B=0;B<t.parts.length;B++){var h=t.parts[B];r.translate(h.vertices,t.velocity),B>0&&(h.position.x+=t.velocity.x,h.position.y+=t.velocity.y),t.angularVelocity!==0&&(r.rotate(h.vertices,t.angularVelocity,t.position),u.rotate(h.axes,t.angularVelocity),B>0&&n.rotateAbout(h.position,t.angularVelocity,t.position,h.position)),c.update(h.bounds,h.vertices,t.velocity)}},e.updateVelocities=function(t){var i=e._baseDelta/t.deltaTime,a=t.velocity;a.x=(t.position.x-t.positionPrev.x)*i,a.y=(t.position.y-t.positionPrev.y)*i,t.speed=Math.sqrt(a.x*a.x+a.y*a.y),t.angularVelocity=(t.angle-t.anglePrev)*i,t.angularSpeed=Math.abs(t.angularVelocity)},e.applyForce=function(t,i,a){var d={x:i.x-t.position.x,y:i.y-t.position.y};t.force.x+=a.x,t.force.y+=a.y,t.torque+=d.x*a.y-d.y*a.x},e._totalProperties=function(t){for(var i={mass:0,area:0,inertia:0,centre:{x:0,y:0}},a=t.parts.length===1?0:1;a<t.parts.length;a++){var d=t.parts[a],m=d.mass!==1/0?d.mass:1;i.mass+=m,i.area+=d.area,i.inertia+=d.inertia,i.centre=n.add(i.centre,n.mult(d.position,m))}return i.centre=n.div(i.centre,i.mass),i}})()},function(p,w,l){var e={};p.exports=e;var r=l(0);(function(){e.on=function(n,s,f){for(var c=s.split(" "),u,o=0;o<c.length;o++)u=c[o],n.events=n.events||{},n.events[u]=n.events[u]||[],n.events[u].push(f);return f},e.off=function(n,s,f){if(!s){n.events={};return}typeof s=="function"&&(f=s,s=r.keys(n.events).join(" "));for(var c=s.split(" "),u=0;u<c.length;u++){var o=n.events[c[u]],t=[];if(f&&o)for(var i=0;i<o.length;i++)o[i]!==f&&t.push(o[i]);n.events[c[u]]=t}},e.trigger=function(n,s,f){var c,u,o,t,i=n.events;if(i&&r.keys(i).length>0){f||(f={}),c=s.split(" ");for(var a=0;a<c.length;a++)if(u=c[a],o=i[u],o){t=r.clone(f,!1),t.name=u,t.source=n;for(var d=0;d<o.length;d++)o[d].apply(n,[t])}}}})()},function(p,w,l){var e={};p.exports=e;var r=l(5),n=l(0),s=l(1),f=l(4);(function(){e.create=function(c){return n.extend({id:n.nextId(),type:"composite",parent:null,isModified:!1,bodies:[],constraints:[],composites:[],label:"Composite",plugin:{},cache:{allBodies:null,allConstraints:null,allComposites:null}},c)},e.setModified=function(c,u,o,t){if(c.isModified=u,u&&c.cache&&(c.cache.allBodies=null,c.cache.allConstraints=null,c.cache.allComposites=null),o&&c.parent&&e.setModified(c.parent,u,o,t),t)for(var i=0;i<c.composites.length;i++){var a=c.composites[i];e.setModified(a,u,o,t)}},e.add=function(c,u){var o=[].concat(u);r.trigger(c,"beforeAdd",{object:u});for(var t=0;t<o.length;t++){var i=o[t];switch(i.type){case"body":if(i.parent!==i){n.warn("Composite.add: skipped adding a compound body part (you must add its parent instead)");break}e.addBody(c,i);break;case"constraint":e.addConstraint(c,i);break;case"composite":e.addComposite(c,i);break;case"mouseConstraint":e.addConstraint(c,i.constraint);break}}return r.trigger(c,"afterAdd",{object:u}),c},e.remove=function(c,u,o){var t=[].concat(u);r.trigger(c,"beforeRemove",{object:u});for(var i=0;i<t.length;i++){var a=t[i];switch(a.type){case"body":e.removeBody(c,a,o);break;case"constraint":e.removeConstraint(c,a,o);break;case"composite":e.removeComposite(c,a,o);break;case"mouseConstraint":e.removeConstraint(c,a.constraint);break}}return r.trigger(c,"afterRemove",{object:u}),c},e.addComposite=function(c,u){return c.composites.push(u),u.parent=c,e.setModified(c,!0,!0,!1),c},e.removeComposite=function(c,u,o){var t=n.indexOf(c.composites,u);if(t!==-1&&e.removeCompositeAt(c,t),o)for(var i=0;i<c.composites.length;i++)e.removeComposite(c.composites[i],u,!0);return c},e.removeCompositeAt=function(c,u){return c.composites.splice(u,1),e.setModified(c,!0,!0,!1),c},e.addBody=function(c,u){return c.bodies.push(u),e.setModified(c,!0,!0,!1),c},e.removeBody=function(c,u,o){var t=n.indexOf(c.bodies,u);if(t!==-1&&e.removeBodyAt(c,t),o)for(var i=0;i<c.composites.length;i++)e.removeBody(c.composites[i],u,!0);return c},e.removeBodyAt=function(c,u){return c.bodies.splice(u,1),e.setModified(c,!0,!0,!1),c},e.addConstraint=function(c,u){return c.constraints.push(u),e.setModified(c,!0,!0,!1),c},e.removeConstraint=function(c,u,o){var t=n.indexOf(c.constraints,u);if(t!==-1&&e.removeConstraintAt(c,t),o)for(var i=0;i<c.composites.length;i++)e.removeConstraint(c.composites[i],u,!0);return c},e.removeConstraintAt=function(c,u){return c.constraints.splice(u,1),e.setModified(c,!0,!0,!1),c},e.clear=function(c,u,o){if(o)for(var t=0;t<c.composites.length;t++)e.clear(c.composites[t],u,!0);return u?c.bodies=c.bodies.filter(function(i){return i.isStatic}):c.bodies.length=0,c.constraints.length=0,c.composites.length=0,e.setModified(c,!0,!0,!1),c},e.allBodies=function(c){if(c.cache&&c.cache.allBodies)return c.cache.allBodies;for(var u=[].concat(c.bodies),o=0;o<c.composites.length;o++)u=u.concat(e.allBodies(c.composites[o]));return c.cache&&(c.cache.allBodies=u),u},e.allConstraints=function(c){if(c.cache&&c.cache.allConstraints)return c.cache.allConstraints;for(var u=[].concat(c.constraints),o=0;o<c.composites.length;o++)u=u.concat(e.allConstraints(c.composites[o]));return c.cache&&(c.cache.allConstraints=u),u},e.allComposites=function(c){if(c.cache&&c.cache.allComposites)return c.cache.allComposites;for(var u=[].concat(c.composites),o=0;o<c.composites.length;o++)u=u.concat(e.allComposites(c.composites[o]));return c.cache&&(c.cache.allComposites=u),u},e.get=function(c,u,o){var t,i;switch(o){case"body":t=e.allBodies(c);break;case"constraint":t=e.allConstraints(c);break;case"composite":t=e.allComposites(c).concat(c);break}return t?(i=t.filter(function(a){return a.id.toString()===u.toString()}),i.length===0?null:i[0]):null},e.move=function(c,u,o){return e.remove(c,u),e.add(o,u),c},e.rebase=function(c){for(var u=e.allBodies(c).concat(e.allConstraints(c)).concat(e.allComposites(c)),o=0;o<u.length;o++)u[o].id=n.nextId();return c},e.translate=function(c,u,o){for(var t=o?e.allBodies(c):c.bodies,i=0;i<t.length;i++)f.translate(t[i],u);return c},e.rotate=function(c,u,o,t){for(var i=Math.cos(u),a=Math.sin(u),d=t?e.allBodies(c):c.bodies,m=0;m<d.length;m++){var P=d[m],E=P.position.x-o.x,B=P.position.y-o.y;f.setPosition(P,{x:o.x+(E*i-B*a),y:o.y+(E*a+B*i)}),f.rotate(P,u)}return c},e.scale=function(c,u,o,t,i){for(var a=i?e.allBodies(c):c.bodies,d=0;d<a.length;d++){var m=a[d],P=m.position.x-t.x,E=m.position.y-t.y;f.setPosition(m,{x:t.x+P*u,y:t.y+E*o}),f.scale(m,u,o)}return c},e.bounds=function(c){for(var u=e.allBodies(c),o=[],t=0;t<u.length;t+=1){var i=u[t];o.push(i.bounds.min,i.bounds.max)}return s.create(o)}})()},function(p,w,l){var e={};p.exports=e;var r=l(4),n=l(5),s=l(0);(function(){e._motionWakeThreshold=.18,e._motionSleepThreshold=.08,e._minBias=.9,e.update=function(f,c){for(var u=c/s._baseDelta,o=e._motionSleepThreshold,t=0;t<f.length;t++){var i=f[t],a=r.getSpeed(i),d=r.getAngularSpeed(i),m=a*a+d*d;if(i.force.x!==0||i.force.y!==0){e.set(i,!1);continue}var P=Math.min(i.motion,m),E=Math.max(i.motion,m);i.motion=e._minBias*P+(1-e._minBias)*E,i.sleepThreshold>0&&i.motion<o?(i.sleepCounter+=1,i.sleepCounter>=i.sleepThreshold/u&&e.set(i,!0)):i.sleepCounter>0&&(i.sleepCounter-=1)}},e.afterCollisions=function(f){for(var c=e._motionSleepThreshold,u=0;u<f.length;u++){var o=f[u];if(o.isActive){var t=o.collision,i=t.bodyA.parent,a=t.bodyB.parent;if(!(i.isSleeping&&a.isSleeping||i.isStatic||a.isStatic)&&(i.isSleeping||a.isSleeping)){var d=i.isSleeping&&!i.isStatic?i:a,m=d===i?a:i;!d.isStatic&&m.motion>c&&e.set(d,!1)}}}},e.set=function(f,c){var u=f.isSleeping;c?(f.isSleeping=!0,f.sleepCounter=f.sleepThreshold,f.positionImpulse.x=0,f.positionImpulse.y=0,f.positionPrev.x=f.position.x,f.positionPrev.y=f.position.y,f.anglePrev=f.angle,f.speed=0,f.angularSpeed=0,f.motion=0,u||n.trigger(f,"sleepStart")):(f.isSleeping=!1,f.sleepCounter=0,u&&n.trigger(f,"sleepEnd"))}})()},function(p,w,l){var e={};p.exports=e;var r=l(3),n=l(9);(function(){var s=[],f={overlap:0,axis:null},c={overlap:0,axis:null};e.create=function(u,o){return{pair:null,collided:!1,bodyA:u,bodyB:o,parentA:u.parent,parentB:o.parent,depth:0,normal:{x:0,y:0},tangent:{x:0,y:0},penetration:{x:0,y:0},supports:[]}},e.collides=function(u,o,t){if(e._overlapAxes(f,u.vertices,o.vertices,u.axes),f.overlap<=0||(e._overlapAxes(c,o.vertices,u.vertices,o.axes),c.overlap<=0))return null;var i=t&&t.table[n.id(u,o)],a;i?a=i.collision:(a=e.create(u,o),a.collided=!0,a.bodyA=u.id<o.id?u:o,a.bodyB=u.id<o.id?o:u,a.parentA=a.bodyA.parent,a.parentB=a.bodyB.parent),u=a.bodyA,o=a.bodyB;var d;f.overlap<c.overlap?d=f:d=c;var m=a.normal,P=a.supports,E=d.axis,B=E.x,h=E.y;B*(o.position.x-u.position.x)+h*(o.position.y-u.position.y)<0?(m.x=B,m.y=h):(m.x=-B,m.y=-h),a.tangent.x=-m.y,a.tangent.y=m.x,a.depth=d.overlap,a.penetration.x=m.x*a.depth,a.penetration.y=m.y*a.depth;var x=e._findSupports(u,o,m,1),C=0;if(r.contains(u.vertices,x[0])&&(P[C++]=x[0]),r.contains(u.vertices,x[1])&&(P[C++]=x[1]),C<2){var v=e._findSupports(o,u,m,-1);r.contains(o.vertices,v[0])&&(P[C++]=v[0]),C<2&&r.contains(o.vertices,v[1])&&(P[C++]=v[1])}return C===0&&(P[C++]=x[0]),P.length=C,a},e._overlapAxes=function(u,o,t,i){var a=o.length,d=t.length,m=o[0].x,P=o[0].y,E=t[0].x,B=t[0].y,h=i.length,x=Number.MAX_VALUE,C=0,v,M,I,b,L,A;for(L=0;L<h;L++){var k=i[L],D=k.x,z=k.y,O=m*D+P*z,N=E*D+B*z,W=O,G=N;for(A=1;A<a;A+=1)b=o[A].x*D+o[A].y*z,b>W?W=b:b<O&&(O=b);for(A=1;A<d;A+=1)b=t[A].x*D+t[A].y*z,b>G?G=b:b<N&&(N=b);if(M=W-N,I=G-O,v=M<I?M:I,v<x&&(x=v,C=L,v<=0))break}u.axis=i[C],u.overlap=x},e._projectToAxis=function(u,o,t){for(var i=o[0].x*t.x+o[0].y*t.y,a=i,d=1;d<o.length;d+=1){var m=o[d].x*t.x+o[d].y*t.y;m>a?a=m:m<i&&(i=m)}u.min=i,u.max=a},e._findSupports=function(u,o,t,i){var a=o.vertices,d=a.length,m=u.position.x,P=u.position.y,E=t.x*i,B=t.y*i,h=Number.MAX_VALUE,x,C,v,M,I;for(I=0;I<d;I+=1)C=a[I],M=E*(m-C.x)+B*(P-C.y),M<h&&(h=M,x=C);return v=a[(d+x.index-1)%d],h=E*(m-v.x)+B*(P-v.y),C=a[(x.index+1)%d],E*(m-C.x)+B*(P-C.y)<h?(s[0]=x,s[1]=C,s):(s[0]=x,s[1]=v,s)}})()},function(p,w,l){var e={};p.exports=e;var r=l(16);(function(){e.create=function(n,s){var f=n.bodyA,c=n.bodyB,u={id:e.id(f,c),bodyA:f,bodyB:c,collision:n,contacts:[],activeContacts:[],separation:0,isActive:!0,confirmedActive:!0,isSensor:f.isSensor||c.isSensor,timeCreated:s,timeUpdated:s,inverseMass:0,friction:0,frictionStatic:0,restitution:0,slop:0};return e.update(u,n,s),u},e.update=function(n,s,f){var c=n.contacts,u=s.supports,o=n.activeContacts,t=s.parentA,i=s.parentB,a=t.vertices.length;n.isActive=!0,n.timeUpdated=f,n.collision=s,n.separation=s.depth,n.inverseMass=t.inverseMass+i.inverseMass,n.friction=t.friction<i.friction?t.friction:i.friction,n.frictionStatic=t.frictionStatic>i.frictionStatic?t.frictionStatic:i.frictionStatic,n.restitution=t.restitution>i.restitution?t.restitution:i.restitution,n.slop=t.slop>i.slop?t.slop:i.slop,s.pair=n,o.length=0;for(var d=0;d<u.length;d++){var m=u[d],P=m.body===t?m.index:a+m.index,E=c[P];E?o.push(E):o.push(c[P]=r.create(m))}},e.setActive=function(n,s,f){s?(n.isActive=!0,n.timeUpdated=f):(n.isActive=!1,n.activeContacts.length=0)},e.id=function(n,s){return n.id<s.id?"A"+n.id+"B"+s.id:"A"+s.id+"B"+n.id}})()},function(p,w,l){var e={};p.exports=e;var r=l(3),n=l(2),s=l(7),f=l(1),c=l(11),u=l(0);(function(){e._warming=.4,e._torqueDampen=1,e._minLength=1e-6,e.create=function(o){var t=o;t.bodyA&&!t.pointA&&(t.pointA={x:0,y:0}),t.bodyB&&!t.pointB&&(t.pointB={x:0,y:0});var i=t.bodyA?n.add(t.bodyA.position,t.pointA):t.pointA,a=t.bodyB?n.add(t.bodyB.position,t.pointB):t.pointB,d=n.magnitude(n.sub(i,a));t.length=typeof t.length<"u"?t.length:d,t.id=t.id||u.nextId(),t.label=t.label||"Constraint",t.type="constraint",t.stiffness=t.stiffness||(t.length>0?1:.7),t.damping=t.damping||0,t.angularStiffness=t.angularStiffness||0,t.angleA=t.bodyA?t.bodyA.angle:t.angleA,t.angleB=t.bodyB?t.bodyB.angle:t.angleB,t.plugin={};var m={visible:!0,lineWidth:2,strokeStyle:"#ffffff",type:"line",anchors:!0};return t.length===0&&t.stiffness>.1?(m.type="pin",m.anchors=!1):t.stiffness<.9&&(m.type="spring"),t.render=u.extend(m,t.render),t},e.preSolveAll=function(o){for(var t=0;t<o.length;t+=1){var i=o[t],a=i.constraintImpulse;i.isStatic||a.x===0&&a.y===0&&a.angle===0||(i.position.x+=a.x,i.position.y+=a.y,i.angle+=a.angle)}},e.solveAll=function(o,t){for(var i=u.clamp(t/u._baseDelta,0,1),a=0;a<o.length;a+=1){var d=o[a],m=!d.bodyA||d.bodyA&&d.bodyA.isStatic,P=!d.bodyB||d.bodyB&&d.bodyB.isStatic;(m||P)&&e.solve(o[a],i)}for(a=0;a<o.length;a+=1)d=o[a],m=!d.bodyA||d.bodyA&&d.bodyA.isStatic,P=!d.bodyB||d.bodyB&&d.bodyB.isStatic,!m&&!P&&e.solve(o[a],i)},e.solve=function(o,t){var i=o.bodyA,a=o.bodyB,d=o.pointA,m=o.pointB;if(!(!i&&!a)){i&&!i.isStatic&&(n.rotate(d,i.angle-o.angleA,d),o.angleA=i.angle),a&&!a.isStatic&&(n.rotate(m,a.angle-o.angleB,m),o.angleB=a.angle);var P=d,E=m;if(i&&(P=n.add(i.position,d)),a&&(E=n.add(a.position,m)),!(!P||!E)){var B=n.sub(P,E),h=n.magnitude(B);h<e._minLength&&(h=e._minLength);var x=(h-o.length)/h,C=o.stiffness>=1||o.length===0,v=C?o.stiffness*t:o.stiffness*t*t,M=o.damping*t,I=n.mult(B,x*v),b=(i?i.inverseMass:0)+(a?a.inverseMass:0),L=(i?i.inverseInertia:0)+(a?a.inverseInertia:0),A=b+L,k,D,z,O,N;if(M>0){var W=n.create();z=n.div(B,h),N=n.sub(a&&n.sub(a.position,a.positionPrev)||W,i&&n.sub(i.position,i.positionPrev)||W),O=n.dot(z,N)}i&&!i.isStatic&&(D=i.inverseMass/b,i.constraintImpulse.x-=I.x*D,i.constraintImpulse.y-=I.y*D,i.position.x-=I.x*D,i.position.y-=I.y*D,M>0&&(i.positionPrev.x-=M*z.x*O*D,i.positionPrev.y-=M*z.y*O*D),k=n.cross(d,I)/A*e._torqueDampen*i.inverseInertia*(1-o.angularStiffness),i.constraintImpulse.angle-=k,i.angle-=k),a&&!a.isStatic&&(D=a.inverseMass/b,a.constraintImpulse.x+=I.x*D,a.constraintImpulse.y+=I.y*D,a.position.x+=I.x*D,a.position.y+=I.y*D,M>0&&(a.positionPrev.x+=M*z.x*O*D,a.positionPrev.y+=M*z.y*O*D),k=n.cross(m,I)/A*e._torqueDampen*a.inverseInertia*(1-o.angularStiffness),a.constraintImpulse.angle+=k,a.angle+=k)}}},e.postSolveAll=function(o){for(var t=0;t<o.length;t++){var i=o[t],a=i.constraintImpulse;if(!(i.isStatic||a.x===0&&a.y===0&&a.angle===0)){s.set(i,!1);for(var d=0;d<i.parts.length;d++){var m=i.parts[d];r.translate(m.vertices,a),d>0&&(m.position.x+=a.x,m.position.y+=a.y),a.angle!==0&&(r.rotate(m.vertices,a.angle,i.position),c.rotate(m.axes,a.angle),d>0&&n.rotateAbout(m.position,a.angle,i.position,m.position)),f.update(m.bounds,m.vertices,i.velocity)}a.angle*=e._warming,a.x*=e._warming,a.y*=e._warming}}},e.pointAWorld=function(o){return{x:(o.bodyA?o.bodyA.position.x:0)+(o.pointA?o.pointA.x:0),y:(o.bodyA?o.bodyA.position.y:0)+(o.pointA?o.pointA.y:0)}},e.pointBWorld=function(o){return{x:(o.bodyB?o.bodyB.position.x:0)+(o.pointB?o.pointB.x:0),y:(o.bodyB?o.bodyB.position.y:0)+(o.pointB?o.pointB.y:0)}}})()},function(p,w,l){var e={};p.exports=e;var r=l(2),n=l(0);(function(){e.fromVertices=function(s){for(var f={},c=0;c<s.length;c++){var u=(c+1)%s.length,o=r.normalise({x:s[u].y-s[c].y,y:s[c].x-s[u].x}),t=o.y===0?1/0:o.x/o.y;t=t.toFixed(3).toString(),f[t]=o}return n.values(f)},e.rotate=function(s,f){if(f!==0)for(var c=Math.cos(f),u=Math.sin(f),o=0;o<s.length;o++){var t=s[o],i;i=t.x*c-t.y*u,t.y=t.x*u+t.y*c,t.x=i}}})()},function(p,w,l){var e={};p.exports=e;var r=l(3),n=l(0),s=l(4),f=l(1),c=l(2);(function(){e.rectangle=function(u,o,t,i,a){a=a||{};var d={label:"Rectangle Body",position:{x:u,y:o},vertices:r.fromPath("L 0 0 L "+t+" 0 L "+t+" "+i+" L 0 "+i)};if(a.chamfer){var m=a.chamfer;d.vertices=r.chamfer(d.vertices,m.radius,m.quality,m.qualityMin,m.qualityMax),delete a.chamfer}return s.create(n.extend({},d,a))},e.trapezoid=function(u,o,t,i,a,d){d=d||{},a*=.5;var m=(1-a*2)*t,P=t*a,E=P+m,B=E+P,h;a<.5?h="L 0 0 L "+P+" "+-i+" L "+E+" "+-i+" L "+B+" 0":h="L 0 0 L "+E+" "+-i+" L "+B+" 0";var x={label:"Trapezoid Body",position:{x:u,y:o},vertices:r.fromPath(h)};if(d.chamfer){var C=d.chamfer;x.vertices=r.chamfer(x.vertices,C.radius,C.quality,C.qualityMin,C.qualityMax),delete d.chamfer}return s.create(n.extend({},x,d))},e.circle=function(u,o,t,i,a){i=i||{};var d={label:"Circle Body",circleRadius:t};a=a||25;var m=Math.ceil(Math.max(10,Math.min(a,t)));return m%2===1&&(m+=1),e.polygon(u,o,m,t,n.extend({},d,i))},e.polygon=function(u,o,t,i,a){if(a=a||{},t<3)return e.circle(u,o,i,a);for(var d=2*Math.PI/t,m="",P=d*.5,E=0;E<t;E+=1){var B=P+E*d,h=Math.cos(B)*i,x=Math.sin(B)*i;m+="L "+h.toFixed(3)+" "+x.toFixed(3)+" "}var C={label:"Polygon Body",position:{x:u,y:o},vertices:r.fromPath(m)};if(a.chamfer){var v=a.chamfer;C.vertices=r.chamfer(C.vertices,v.radius,v.quality,v.qualityMin,v.qualityMax),delete a.chamfer}return s.create(n.extend({},C,a))},e.fromVertices=function(u,o,t,i,a,d,m,P){var E=n.getDecomp(),B,h,x,C,v,M,I,b,L,A,k;for(B=!!(E&&E.quickDecomp),i=i||{},x=[],a=typeof a<"u"?a:!1,d=typeof d<"u"?d:.01,m=typeof m<"u"?m:10,P=typeof P<"u"?P:.01,n.isArray(t[0])||(t=[t]),A=0;A<t.length;A+=1)if(M=t[A],C=r.isConvex(M),v=!C,v&&!B&&n.warnOnce("Bodies.fromVertices: Install the 'poly-decomp' library and use Common.setDecomp or provide 'decomp' as a global to decompose concave vertices."),C||!B)C?M=r.clockwiseSort(M):M=r.hull(M),x.push({position:{x:u,y:o},vertices:M});else{var D=M.map(function(K){return[K.x,K.y]});E.makeCCW(D),d!==!1&&E.removeCollinearPoints(D,d),P!==!1&&E.removeDuplicatePoints&&E.removeDuplicatePoints(D,P);var z=E.quickDecomp(D);for(I=0;I<z.length;I++){var O=z[I],N=O.map(function(K){return{x:K[0],y:K[1]}});m>0&&r.area(N)<m||x.push({position:r.centre(N),vertices:N})}}for(I=0;I<x.length;I++)x[I]=s.create(n.extend(x[I],i));if(a){var W=5;for(I=0;I<x.length;I++){var G=x[I];for(b=I+1;b<x.length;b++){var Y=x[b];if(f.overlaps(G.bounds,Y.bounds)){var V=G.vertices,X=Y.vertices;for(L=0;L<G.vertices.length;L++)for(k=0;k<Y.vertices.length;k++){var Z=c.magnitudeSquared(c.sub(V[(L+1)%V.length],X[k])),ee=c.magnitudeSquared(c.sub(V[L],X[(k+1)%X.length]));Z<W&&ee<W&&(V[L].isInternal=!0,X[k].isInternal=!0)}}}}}return x.length>1?(h=s.create(n.extend({parts:x.slice(0)},i)),s.setPosition(h,{x:u,y:o}),h):x[0]}})()},function(p,w,l){var e={};p.exports=e;var r=l(0),n=l(8);(function(){e.create=function(s){var f={bodies:[],pairs:null};return r.extend(f,s)},e.setBodies=function(s,f){s.bodies=f.slice(0)},e.clear=function(s){s.bodies=[]},e.collisions=function(s){var f=[],c=s.pairs,u=s.bodies,o=u.length,t=e.canCollide,i=n.collides,a,d;for(u.sort(e._compareBoundsX),a=0;a<o;a++){var m=u[a],P=m.bounds,E=m.bounds.max.x,B=m.bounds.max.y,h=m.bounds.min.y,x=m.isStatic||m.isSleeping,C=m.parts.length,v=C===1;for(d=a+1;d<o;d++){var M=u[d],I=M.bounds;if(I.min.x>E)break;if(!(B<I.min.y||h>I.max.y)&&!(x&&(M.isStatic||M.isSleeping))&&t(m.collisionFilter,M.collisionFilter)){var b=M.parts.length;if(v&&b===1){var L=i(m,M,c);L&&f.push(L)}else for(var A=C>1?1:0,k=b>1?1:0,D=A;D<C;D++)for(var z=m.parts[D],P=z.bounds,O=k;O<b;O++){var N=M.parts[O],I=N.bounds;if(!(P.min.x>I.max.x||P.max.x<I.min.x||P.max.y<I.min.y||P.min.y>I.max.y)){var L=i(z,N,c);L&&f.push(L)}}}}}return f},e.canCollide=function(s,f){return s.group===f.group&&s.group!==0?s.group>0:(s.mask&f.category)!==0&&(f.mask&s.category)!==0},e._compareBoundsX=function(s,f){return s.bounds.min.x-f.bounds.min.x}})()},function(p,w,l){var e={};p.exports=e;var r=l(0);(function(){e.create=function(n){var s={};return n||r.log("Mouse.create: element was undefined, defaulting to document.body","warn"),s.element=n||document.body,s.absolute={x:0,y:0},s.position={x:0,y:0},s.mousedownPosition={x:0,y:0},s.mouseupPosition={x:0,y:0},s.offset={x:0,y:0},s.scale={x:1,y:1},s.wheelDelta=0,s.button=-1,s.pixelRatio=parseInt(s.element.getAttribute("data-pixel-ratio"),10)||1,s.sourceEvents={mousemove:null,mousedown:null,mouseup:null,mousewheel:null},s.mousemove=function(f){var c=e._getRelativeMousePosition(f,s.element,s.pixelRatio),u=f.changedTouches;u&&(s.button=0,f.preventDefault()),s.absolute.x=c.x,s.absolute.y=c.y,s.position.x=s.absolute.x*s.scale.x+s.offset.x,s.position.y=s.absolute.y*s.scale.y+s.offset.y,s.sourceEvents.mousemove=f},s.mousedown=function(f){var c=e._getRelativeMousePosition(f,s.element,s.pixelRatio),u=f.changedTouches;u?(s.button=0,f.preventDefault()):s.button=f.button,s.absolute.x=c.x,s.absolute.y=c.y,s.position.x=s.absolute.x*s.scale.x+s.offset.x,s.position.y=s.absolute.y*s.scale.y+s.offset.y,s.mousedownPosition.x=s.position.x,s.mousedownPosition.y=s.position.y,s.sourceEvents.mousedown=f},s.mouseup=function(f){var c=e._getRelativeMousePosition(f,s.element,s.pixelRatio),u=f.changedTouches;u&&f.preventDefault(),s.button=-1,s.absolute.x=c.x,s.absolute.y=c.y,s.position.x=s.absolute.x*s.scale.x+s.offset.x,s.position.y=s.absolute.y*s.scale.y+s.offset.y,s.mouseupPosition.x=s.position.x,s.mouseupPosition.y=s.position.y,s.sourceEvents.mouseup=f},s.mousewheel=function(f){s.wheelDelta=Math.max(-1,Math.min(1,f.wheelDelta||-f.detail)),f.preventDefault()},e.setElement(s,s.element),s},e.setElement=function(n,s){n.element=s,s.addEventListener("mousemove",n.mousemove),s.addEventListener("mousedown",n.mousedown),s.addEventListener("mouseup",n.mouseup),s.addEventListener("mousewheel",n.mousewheel),s.addEventListener("DOMMouseScroll",n.mousewheel),s.addEventListener("touchmove",n.mousemove),s.addEventListener("touchstart",n.mousedown),s.addEventListener("touchend",n.mouseup)},e.clearSourceEvents=function(n){n.sourceEvents.mousemove=null,n.sourceEvents.mousedown=null,n.sourceEvents.mouseup=null,n.sourceEvents.mousewheel=null,n.wheelDelta=0},e.setOffset=function(n,s){n.offset.x=s.x,n.offset.y=s.y,n.position.x=n.absolute.x*n.scale.x+n.offset.x,n.position.y=n.absolute.y*n.scale.y+n.offset.y},e.setScale=function(n,s){n.scale.x=s.x,n.scale.y=s.y,n.position.x=n.absolute.x*n.scale.x+n.offset.x,n.position.y=n.absolute.y*n.scale.y+n.offset.y},e._getRelativeMousePosition=function(n,s,f){var c=s.getBoundingClientRect(),u=document.documentElement||document.body.parentNode||document.body,o=window.pageXOffset!==void 0?window.pageXOffset:u.scrollLeft,t=window.pageYOffset!==void 0?window.pageYOffset:u.scrollTop,i=n.changedTouches,a,d;return i?(a=i[0].pageX-c.left-o,d=i[0].pageY-c.top-t):(a=n.pageX-c.left-o,d=n.pageY-c.top-t),{x:a/(s.clientWidth/(s.width||s.clientWidth)*f),y:d/(s.clientHeight/(s.height||s.clientHeight)*f)}}})()},function(p,w,l){var e={};p.exports=e;var r=l(0);(function(){e._registry={},e.register=function(n){if(e.isPlugin(n)||r.warn("Plugin.register:",e.toString(n),"does not implement all required fields."),n.name in e._registry){var s=e._registry[n.name],f=e.versionParse(n.version).number,c=e.versionParse(s.version).number;f>c?(r.warn("Plugin.register:",e.toString(s),"was upgraded to",e.toString(n)),e._registry[n.name]=n):f<c?r.warn("Plugin.register:",e.toString(s),"can not be downgraded to",e.toString(n)):n!==s&&r.warn("Plugin.register:",e.toString(n),"is already registered to different plugin object")}else e._registry[n.name]=n;return n},e.resolve=function(n){return e._registry[e.dependencyParse(n).name]},e.toString=function(n){return typeof n=="string"?n:(n.name||"anonymous")+"@"+(n.version||n.range||"0.0.0")},e.isPlugin=function(n){return n&&n.name&&n.version&&n.install},e.isUsed=function(n,s){return n.used.indexOf(s)>-1},e.isFor=function(n,s){var f=n.for&&e.dependencyParse(n.for);return!n.for||s.name===f.name&&e.versionSatisfies(s.version,f.range)},e.use=function(n,s){if(n.uses=(n.uses||[]).concat(s||[]),n.uses.length===0){r.warn("Plugin.use:",e.toString(n),"does not specify any dependencies to install.");return}for(var f=e.dependencies(n),c=r.topologicalSort(f),u=[],o=0;o<c.length;o+=1)if(c[o]!==n.name){var t=e.resolve(c[o]);if(!t){u.push("❌ "+c[o]);continue}e.isUsed(n,t.name)||(e.isFor(t,n)||(r.warn("Plugin.use:",e.toString(t),"is for",t.for,"but installed on",e.toString(n)+"."),t._warned=!0),t.install?t.install(n):(r.warn("Plugin.use:",e.toString(t),"does not specify an install function."),t._warned=!0),t._warned?(u.push("🔶 "+e.toString(t)),delete t._warned):u.push("✅ "+e.toString(t)),n.used.push(t.name))}u.length>0&&r.info(u.join("  "))},e.dependencies=function(n,s){var f=e.dependencyParse(n),c=f.name;if(s=s||{},!(c in s)){n=e.resolve(n)||n,s[c]=r.map(n.uses||[],function(o){e.isPlugin(o)&&e.register(o);var t=e.dependencyParse(o),i=e.resolve(o);return i&&!e.versionSatisfies(i.version,t.range)?(r.warn("Plugin.dependencies:",e.toString(i),"does not satisfy",e.toString(t),"used by",e.toString(f)+"."),i._warned=!0,n._warned=!0):i||(r.warn("Plugin.dependencies:",e.toString(o),"used by",e.toString(f),"could not be resolved."),n._warned=!0),t.name});for(var u=0;u<s[c].length;u+=1)e.dependencies(s[c][u],s);return s}},e.dependencyParse=function(n){if(r.isString(n)){var s=/^[\w-]+(@(\*|[\^~]?\d+\.\d+\.\d+(-[0-9A-Za-z-+]+)?))?$/;return s.test(n)||r.warn("Plugin.dependencyParse:",n,"is not a valid dependency string."),{name:n.split("@")[0],range:n.split("@")[1]||"*"}}return{name:n.name,range:n.range||n.version}},e.versionParse=function(n){var s=/^(\*)|(\^|~|>=|>)?\s*((\d+)\.(\d+)\.(\d+))(-[0-9A-Za-z-+]+)?$/;s.test(n)||r.warn("Plugin.versionParse:",n,"is not a valid version or range.");var f=s.exec(n),c=Number(f[4]),u=Number(f[5]),o=Number(f[6]);return{isRange:!!(f[1]||f[2]),version:f[3],range:n,operator:f[1]||f[2]||"",major:c,minor:u,patch:o,parts:[c,u,o],prerelease:f[7],number:c*1e8+u*1e4+o}},e.versionSatisfies=function(n,s){s=s||"*";var f=e.versionParse(s),c=e.versionParse(n);if(f.isRange){if(f.operator==="*"||n==="*")return!0;if(f.operator===">")return c.number>f.number;if(f.operator===">=")return c.number>=f.number;if(f.operator==="~")return c.major===f.major&&c.minor===f.minor&&c.patch>=f.patch;if(f.operator==="^")return f.major>0?c.major===f.major&&c.number>=f.number:f.minor>0?c.minor===f.minor&&c.patch>=f.patch:c.patch===f.patch}return n===s||n==="*"}})()},function(p,w){var l={};p.exports=l,function(){l.create=function(e){return{vertex:e,normalImpulse:0,tangentImpulse:0}}}()},function(p,w,l){var e={};p.exports=e;var r=l(7),n=l(18),s=l(13),f=l(19),c=l(5),u=l(6),o=l(10),t=l(0),i=l(4);(function(){e.create=function(a){a=a||{};var d={positionIterations:6,velocityIterations:4,constraintIterations:2,enableSleeping:!1,events:[],plugin:{},gravity:{x:0,y:1,scale:.001},timing:{timestamp:0,timeScale:1,lastDelta:0,lastElapsed:0}},m=t.extend(d,a);return m.world=a.world||u.create({label:"World"}),m.pairs=a.pairs||f.create(),m.detector=a.detector||s.create(),m.grid={buckets:[]},m.world.gravity=m.gravity,m.broadphase=m.grid,m.metrics={},m},e.update=function(a,d){var m=t.now(),P=a.world,E=a.detector,B=a.pairs,h=a.timing,x=h.timestamp,C;d=typeof d<"u"?d:t._baseDelta,d*=h.timeScale,h.timestamp+=d,h.lastDelta=d;var v={timestamp:h.timestamp,delta:d};c.trigger(a,"beforeUpdate",v);var M=u.allBodies(P),I=u.allConstraints(P);for(P.isModified&&(s.setBodies(E,M),u.setModified(P,!1,!1,!0)),a.enableSleeping&&r.update(M,d),e._bodiesApplyGravity(M,a.gravity),d>0&&e._bodiesUpdate(M,d),o.preSolveAll(M),C=0;C<a.constraintIterations;C++)o.solveAll(I,d);o.postSolveAll(M),E.pairs=a.pairs;var b=s.collisions(E);f.update(B,b,x),a.enableSleeping&&r.afterCollisions(B.list),B.collisionStart.length>0&&c.trigger(a,"collisionStart",{pairs:B.collisionStart});var L=t.clamp(20/a.positionIterations,0,1);for(n.preSolvePosition(B.list),C=0;C<a.positionIterations;C++)n.solvePosition(B.list,d,L);for(n.postSolvePosition(M),o.preSolveAll(M),C=0;C<a.constraintIterations;C++)o.solveAll(I,d);for(o.postSolveAll(M),n.preSolveVelocity(B.list),C=0;C<a.velocityIterations;C++)n.solveVelocity(B.list,d);return e._bodiesUpdateVelocities(M),B.collisionActive.length>0&&c.trigger(a,"collisionActive",{pairs:B.collisionActive}),B.collisionEnd.length>0&&c.trigger(a,"collisionEnd",{pairs:B.collisionEnd}),e._bodiesClearForces(M),c.trigger(a,"afterUpdate",v),a.timing.lastElapsed=t.now()-m,a},e.merge=function(a,d){if(t.extend(a,d),d.world){a.world=d.world,e.clear(a);for(var m=u.allBodies(a.world),P=0;P<m.length;P++){var E=m[P];r.set(E,!1),E.id=t.nextId()}}},e.clear=function(a){f.clear(a.pairs),s.clear(a.detector)},e._bodiesClearForces=function(a){for(var d=a.length,m=0;m<d;m++){var P=a[m];P.force.x=0,P.force.y=0,P.torque=0}},e._bodiesApplyGravity=function(a,d){var m=typeof d.scale<"u"?d.scale:.001,P=a.length;if(!(d.x===0&&d.y===0||m===0))for(var E=0;E<P;E++){var B=a[E];B.isStatic||B.isSleeping||(B.force.y+=B.mass*d.y*m,B.force.x+=B.mass*d.x*m)}},e._bodiesUpdate=function(a,d){for(var m=a.length,P=0;P<m;P++){var E=a[P];E.isStatic||E.isSleeping||i.update(E,d)}},e._bodiesUpdateVelocities=function(a){for(var d=a.length,m=0;m<d;m++)i.updateVelocities(a[m])}})()},function(p,w,l){var e={};p.exports=e;var r=l(3),n=l(0),s=l(1);(function(){e._restingThresh=2,e._restingThreshTangent=Math.sqrt(6),e._positionDampen=.9,e._positionWarming=.8,e._frictionNormalMultiplier=5,e._frictionMaxStatic=Number.MAX_VALUE,e.preSolvePosition=function(f){var c,u,o,t=f.length;for(c=0;c<t;c++)u=f[c],u.isActive&&(o=u.activeContacts.length,u.collision.parentA.totalContacts+=o,u.collision.parentB.totalContacts+=o)},e.solvePosition=function(f,c,u){var o,t,i,a,d,m,P,E,B=e._positionDampen*(u||1),h=n.clamp(c/n._baseDelta,0,1),x=f.length;for(o=0;o<x;o++)t=f[o],!(!t.isActive||t.isSensor)&&(i=t.collision,a=i.parentA,d=i.parentB,m=i.normal,t.separation=m.x*(d.positionImpulse.x+i.penetration.x-a.positionImpulse.x)+m.y*(d.positionImpulse.y+i.penetration.y-a.positionImpulse.y));for(o=0;o<x;o++)t=f[o],!(!t.isActive||t.isSensor)&&(i=t.collision,a=i.parentA,d=i.parentB,m=i.normal,E=t.separation-t.slop*h,(a.isStatic||d.isStatic)&&(E*=2),a.isStatic||a.isSleeping||(P=B/a.totalContacts,a.positionImpulse.x+=m.x*E*P,a.positionImpulse.y+=m.y*E*P),d.isStatic||d.isSleeping||(P=B/d.totalContacts,d.positionImpulse.x-=m.x*E*P,d.positionImpulse.y-=m.y*E*P))},e.postSolvePosition=function(f){for(var c=e._positionWarming,u=f.length,o=r.translate,t=s.update,i=0;i<u;i++){var a=f[i],d=a.positionImpulse,m=d.x,P=d.y,E=a.velocity;if(a.totalContacts=0,m!==0||P!==0){for(var B=0;B<a.parts.length;B++){var h=a.parts[B];o(h.vertices,d),t(h.bounds,h.vertices,E),h.position.x+=m,h.position.y+=P}a.positionPrev.x+=m,a.positionPrev.y+=P,m*E.x+P*E.y<0?(d.x=0,d.y=0):(d.x*=c,d.y*=c)}}},e.preSolveVelocity=function(f){var c=f.length,u,o;for(u=0;u<c;u++){var t=f[u];if(!(!t.isActive||t.isSensor)){var i=t.activeContacts,a=i.length,d=t.collision,m=d.parentA,P=d.parentB,E=d.normal,B=d.tangent;for(o=0;o<a;o++){var h=i[o],x=h.vertex,C=h.normalImpulse,v=h.tangentImpulse;if(C!==0||v!==0){var M=E.x*C+B.x*v,I=E.y*C+B.y*v;m.isStatic||m.isSleeping||(m.positionPrev.x+=M*m.inverseMass,m.positionPrev.y+=I*m.inverseMass,m.anglePrev+=m.inverseInertia*((x.x-m.position.x)*I-(x.y-m.position.y)*M)),P.isStatic||P.isSleeping||(P.positionPrev.x-=M*P.inverseMass,P.positionPrev.y-=I*P.inverseMass,P.anglePrev-=P.inverseInertia*((x.x-P.position.x)*I-(x.y-P.position.y)*M))}}}}},e.solveVelocity=function(f,c){var u=c/n._baseDelta,o=u*u,t=o*u,i=-e._restingThresh*u,a=e._restingThreshTangent,d=e._frictionNormalMultiplier*u,m=e._frictionMaxStatic,P=f.length,E,B,h,x;for(h=0;h<P;h++){var C=f[h];if(!(!C.isActive||C.isSensor)){var v=C.collision,M=v.parentA,I=v.parentB,b=M.velocity,L=I.velocity,A=v.normal.x,k=v.normal.y,D=v.tangent.x,z=v.tangent.y,O=C.activeContacts,N=O.length,W=1/N,G=M.inverseMass+I.inverseMass,Y=C.friction*C.frictionStatic*d;for(b.x=M.position.x-M.positionPrev.x,b.y=M.position.y-M.positionPrev.y,L.x=I.position.x-I.positionPrev.x,L.y=I.position.y-I.positionPrev.y,M.angularVelocity=M.angle-M.anglePrev,I.angularVelocity=I.angle-I.anglePrev,x=0;x<N;x++){var V=O[x],X=V.vertex,Z=X.x-M.position.x,ee=X.y-M.position.y,K=X.x-I.position.x,ne=X.y-I.position.y,j=b.x-ee*M.angularVelocity,we=b.y+Z*M.angularVelocity,Pe=L.x-ne*I.angularVelocity,Ie=L.y+K*I.angularVelocity,ge=j-Pe,pe=we-Ie,ue=A*ge+k*pe,re=D*ge+z*pe,me=C.separation+ue,de=Math.min(me,1);de=me<0?0:de;var ve=de*Y;re<-ve||re>ve?(B=re>0?re:-re,E=C.friction*(re>0?1:-1)*t,E<-B?E=-B:E>B&&(E=B)):(E=re,B=m);var xe=Z*k-ee*A,ye=K*k-ne*A,Se=W/(G+M.inverseInertia*xe*xe+I.inverseInertia*ye*ye),le=(1+C.restitution)*ue*Se;if(E*=Se,ue<i)V.normalImpulse=0;else{var Me=V.normalImpulse;V.normalImpulse+=le,V.normalImpulse>0&&(V.normalImpulse=0),le=V.normalImpulse-Me}if(re<-a||re>a)V.tangentImpulse=0;else{var Ee=V.tangentImpulse;V.tangentImpulse+=E,V.tangentImpulse<-B&&(V.tangentImpulse=-B),V.tangentImpulse>B&&(V.tangentImpulse=B),E=V.tangentImpulse-Ee}var ce=A*le+D*E,fe=k*le+z*E;M.isStatic||M.isSleeping||(M.positionPrev.x+=ce*M.inverseMass,M.positionPrev.y+=fe*M.inverseMass,M.anglePrev+=(Z*fe-ee*ce)*M.inverseInertia),I.isStatic||I.isSleeping||(I.positionPrev.x-=ce*I.inverseMass,I.positionPrev.y-=fe*I.inverseMass,I.anglePrev-=(K*fe-ne*ce)*I.inverseInertia)}}}}})()},function(p,w,l){var e={};p.exports=e;var r=l(9),n=l(0);(function(){e.create=function(s){return n.extend({table:{},list:[],collisionStart:[],collisionActive:[],collisionEnd:[]},s)},e.update=function(s,f,c){var u=s.list,o=u.length,t=s.table,i=f.length,a=s.collisionStart,d=s.collisionEnd,m=s.collisionActive,P,E,B,h;for(a.length=0,d.length=0,m.length=0,h=0;h<o;h++)u[h].confirmedActive=!1;for(h=0;h<i;h++)P=f[h],B=P.pair,B?(B.isActive?m.push(B):a.push(B),r.update(B,P,c),B.confirmedActive=!0):(B=r.create(P,c),t[B.id]=B,a.push(B),u.push(B));var x=[];for(o=u.length,h=0;h<o;h++)B=u[h],B.confirmedActive||(r.setActive(B,!1,c),d.push(B),!B.collision.bodyA.isSleeping&&!B.collision.bodyB.isSleeping&&x.push(h));for(h=0;h<x.length;h++)E=x[h]-h,B=u[E],u.splice(E,1),delete t[B.id]},e.clear=function(s){return s.table={},s.list.length=0,s.collisionStart.length=0,s.collisionActive.length=0,s.collisionEnd.length=0,s}})()},function(p,w,l){var e=p.exports=l(21);e.Axes=l(11),e.Bodies=l(12),e.Body=l(4),e.Bounds=l(1),e.Collision=l(8),e.Common=l(0),e.Composite=l(6),e.Composites=l(22),e.Constraint=l(10),e.Contact=l(16),e.Detector=l(13),e.Engine=l(17),e.Events=l(5),e.Grid=l(23),e.Mouse=l(14),e.MouseConstraint=l(24),e.Pair=l(9),e.Pairs=l(19),e.Plugin=l(15),e.Query=l(25),e.Render=l(26),e.Resolver=l(18),e.Runner=l(27),e.SAT=l(28),e.Sleeping=l(7),e.Svg=l(29),e.Vector=l(2),e.Vertices=l(3),e.World=l(30),e.Engine.run=e.Runner.run,e.Common.deprecated(e.Engine,"run","Engine.run ➤ use Matter.Runner.run(engine) instead")},function(p,w,l){var e={};p.exports=e;var r=l(15),n=l(0);(function(){e.name="matter-js",e.version="0.19.0",e.uses=[],e.used=[],e.use=function(){r.use(e,Array.prototype.slice.call(arguments))},e.before=function(s,f){return s=s.replace(/^Matter./,""),n.chainPathBefore(e,s,f)},e.after=function(s,f){return s=s.replace(/^Matter./,""),n.chainPathAfter(e,s,f)}})()},function(p,w,l){var e={};p.exports=e;var r=l(6),n=l(10),s=l(0),f=l(4),c=l(12),u=s.deprecated;(function(){e.stack=function(o,t,i,a,d,m,P){for(var E=r.create({label:"Stack"}),B=o,h=t,x,C=0,v=0;v<a;v++){for(var M=0,I=0;I<i;I++){var b=P(B,h,I,v,x,C);if(b){var L=b.bounds.max.y-b.bounds.min.y,A=b.bounds.max.x-b.bounds.min.x;L>M&&(M=L),f.translate(b,{x:A*.5,y:L*.5}),B=b.bounds.max.x+d,r.addBody(E,b),x=b,C+=1}else B+=d}h+=M+m,B=o}return E},e.chain=function(o,t,i,a,d,m){for(var P=o.bodies,E=1;E<P.length;E++){var B=P[E-1],h=P[E],x=B.bounds.max.y-B.bounds.min.y,C=B.bounds.max.x-B.bounds.min.x,v=h.bounds.max.y-h.bounds.min.y,M=h.bounds.max.x-h.bounds.min.x,I={bodyA:B,pointA:{x:C*t,y:x*i},bodyB:h,pointB:{x:M*a,y:v*d}},b=s.extend(I,m);r.addConstraint(o,n.create(b))}return o.label+=" Chain",o},e.mesh=function(o,t,i,a,d){var m=o.bodies,P,E,B,h,x;for(P=0;P<i;P++){for(E=1;E<t;E++)B=m[E-1+P*t],h=m[E+P*t],r.addConstraint(o,n.create(s.extend({bodyA:B,bodyB:h},d)));if(P>0)for(E=0;E<t;E++)B=m[E+(P-1)*t],h=m[E+P*t],r.addConstraint(o,n.create(s.extend({bodyA:B,bodyB:h},d))),a&&E>0&&(x=m[E-1+(P-1)*t],r.addConstraint(o,n.create(s.extend({bodyA:x,bodyB:h},d)))),a&&E<t-1&&(x=m[E+1+(P-1)*t],r.addConstraint(o,n.create(s.extend({bodyA:x,bodyB:h},d))))}return o.label+=" Mesh",o},e.pyramid=function(o,t,i,a,d,m,P){return e.stack(o,t,i,a,d,m,function(E,B,h,x,C,v){var M=Math.min(a,Math.ceil(i/2)),I=C?C.bounds.max.x-C.bounds.min.x:0;if(!(x>M)){x=M-x;var b=x,L=i-1-x;if(!(h<b||h>L)){v===1&&f.translate(C,{x:(h+(i%2===1?1:-1))*I,y:0});var A=C?h*I:0;return P(o+A+h*d,B,h,x,C,v)}}})},e.newtonsCradle=function(o,t,i,a,d){for(var m=r.create({label:"Newtons Cradle"}),P=0;P<i;P++){var E=1.9,B=c.circle(o+P*(a*E),t+d,a,{inertia:1/0,restitution:1,friction:0,frictionAir:1e-4,slop:1}),h=n.create({pointA:{x:o+P*(a*E),y:t},bodyB:B});r.addBody(m,B),r.addConstraint(m,h)}return m},u(e,"newtonsCradle","Composites.newtonsCradle ➤ moved to newtonsCradle example"),e.car=function(o,t,i,a,d){var m=f.nextGroup(!0),P=20,E=-i*.5+P,B=i*.5-P,h=0,x=r.create({label:"Car"}),C=c.rectangle(o,t,i,a,{collisionFilter:{group:m},chamfer:{radius:a*.5},density:2e-4}),v=c.circle(o+E,t+h,d,{collisionFilter:{group:m},friction:.8}),M=c.circle(o+B,t+h,d,{collisionFilter:{group:m},friction:.8}),I=n.create({bodyB:C,pointB:{x:E,y:h},bodyA:v,stiffness:1,length:0}),b=n.create({bodyB:C,pointB:{x:B,y:h},bodyA:M,stiffness:1,length:0});return r.addBody(x,C),r.addBody(x,v),r.addBody(x,M),r.addConstraint(x,I),r.addConstraint(x,b),x},u(e,"car","Composites.car ➤ moved to car example"),e.softBody=function(o,t,i,a,d,m,P,E,B,h){B=s.extend({inertia:1/0},B),h=s.extend({stiffness:.2,render:{type:"line",anchors:!1}},h);var x=e.stack(o,t,i,a,d,m,function(C,v){return c.circle(C,v,E,B)});return e.mesh(x,i,a,P,h),x.label="Soft Body",x},u(e,"softBody","Composites.softBody ➤ moved to softBody and cloth examples")})()},function(p,w,l){var e={};p.exports=e;var r=l(9),n=l(0),s=n.deprecated;(function(){e.create=function(f){var c={buckets:{},pairs:{},pairsList:[],bucketWidth:48,bucketHeight:48};return n.extend(c,f)},e.update=function(f,c,u,o){var t,i,a,d=u.world,m=f.buckets,P,E,B=!1;for(t=0;t<c.length;t++){var h=c[t];if(!(h.isSleeping&&!o)&&!(d.bounds&&(h.bounds.max.x<d.bounds.min.x||h.bounds.min.x>d.bounds.max.x||h.bounds.max.y<d.bounds.min.y||h.bounds.min.y>d.bounds.max.y))){var x=e._getRegion(f,h);if(!h.region||x.id!==h.region.id||o){(!h.region||o)&&(h.region=x);var C=e._regionUnion(x,h.region);for(i=C.startCol;i<=C.endCol;i++)for(a=C.startRow;a<=C.endRow;a++){E=e._getBucketId(i,a),P=m[E];var v=i>=x.startCol&&i<=x.endCol&&a>=x.startRow&&a<=x.endRow,M=i>=h.region.startCol&&i<=h.region.endCol&&a>=h.region.startRow&&a<=h.region.endRow;!v&&M&&M&&P&&e._bucketRemoveBody(f,P,h),(h.region===x||v&&!M||o)&&(P||(P=e._createBucket(m,E)),e._bucketAddBody(f,P,h))}h.region=x,B=!0}}}B&&(f.pairsList=e._createActivePairsList(f))},s(e,"update","Grid.update ➤ replaced by Matter.Detector"),e.clear=function(f){f.buckets={},f.pairs={},f.pairsList=[]},s(e,"clear","Grid.clear ➤ replaced by Matter.Detector"),e._regionUnion=function(f,c){var u=Math.min(f.startCol,c.startCol),o=Math.max(f.endCol,c.endCol),t=Math.min(f.startRow,c.startRow),i=Math.max(f.endRow,c.endRow);return e._createRegion(u,o,t,i)},e._getRegion=function(f,c){var u=c.bounds,o=Math.floor(u.min.x/f.bucketWidth),t=Math.floor(u.max.x/f.bucketWidth),i=Math.floor(u.min.y/f.bucketHeight),a=Math.floor(u.max.y/f.bucketHeight);return e._createRegion(o,t,i,a)},e._createRegion=function(f,c,u,o){return{id:f+","+c+","+u+","+o,startCol:f,endCol:c,startRow:u,endRow:o}},e._getBucketId=function(f,c){return"C"+f+"R"+c},e._createBucket=function(f,c){var u=f[c]=[];return u},e._bucketAddBody=function(f,c,u){var o=f.pairs,t=r.id,i=c.length,a;for(a=0;a<i;a++){var d=c[a];if(!(u.id===d.id||u.isStatic&&d.isStatic)){var m=t(u,d),P=o[m];P?P[2]+=1:o[m]=[u,d,1]}}c.push(u)},e._bucketRemoveBody=function(f,c,u){var o=f.pairs,t=r.id,i;c.splice(n.indexOf(c,u),1);var a=c.length;for(i=0;i<a;i++){var d=o[t(u,c[i])];d&&(d[2]-=1)}},e._createActivePairsList=function(f){var c,u=f.pairs,o=n.keys(u),t=o.length,i=[],a;for(a=0;a<t;a++)c=u[o[a]],c[2]>0?i.push(c):delete u[o[a]];return i}})()},function(p,w,l){var e={};p.exports=e;var r=l(3),n=l(7),s=l(14),f=l(5),c=l(13),u=l(10),o=l(6),t=l(0),i=l(1);(function(){e.create=function(a,d){var m=(a?a.mouse:null)||(d?d.mouse:null);m||(a&&a.render&&a.render.canvas?m=s.create(a.render.canvas):d&&d.element?m=s.create(d.element):(m=s.create(),t.warn("MouseConstraint.create: options.mouse was undefined, options.element was undefined, may not function as expected")));var P=u.create({label:"Mouse Constraint",pointA:m.position,pointB:{x:0,y:0},length:.01,stiffness:.1,angularStiffness:1,render:{strokeStyle:"#90EE90",lineWidth:3}}),E={type:"mouseConstraint",mouse:m,element:null,body:null,constraint:P,collisionFilter:{category:1,mask:4294967295,group:0}},B=t.extend(E,d);return f.on(a,"beforeUpdate",function(){var h=o.allBodies(a.world);e.update(B,h),e._triggerEvents(B)}),B},e.update=function(a,d){var m=a.mouse,P=a.constraint,E=a.body;if(m.button===0){if(P.bodyB)n.set(P.bodyB,!1),P.pointA=m.position;else for(var B=0;B<d.length;B++)if(E=d[B],i.contains(E.bounds,m.position)&&c.canCollide(E.collisionFilter,a.collisionFilter))for(var h=E.parts.length>1?1:0;h<E.parts.length;h++){var x=E.parts[h];if(r.contains(x.vertices,m.position)){P.pointA=m.position,P.bodyB=a.body=E,P.pointB={x:m.position.x-E.position.x,y:m.position.y-E.position.y},P.angleB=E.angle,n.set(E,!1),f.trigger(a,"startdrag",{mouse:m,body:E});break}}}else P.bodyB=a.body=null,P.pointB=null,E&&f.trigger(a,"enddrag",{mouse:m,body:E})},e._triggerEvents=function(a){var d=a.mouse,m=d.sourceEvents;m.mousemove&&f.trigger(a,"mousemove",{mouse:d}),m.mousedown&&f.trigger(a,"mousedown",{mouse:d}),m.mouseup&&f.trigger(a,"mouseup",{mouse:d}),s.clearSourceEvents(d)}})()},function(p,w,l){var e={};p.exports=e;var r=l(2),n=l(8),s=l(1),f=l(12),c=l(3);(function(){e.collides=function(u,o){for(var t=[],i=o.length,a=u.bounds,d=n.collides,m=s.overlaps,P=0;P<i;P++){var E=o[P],B=E.parts.length,h=B===1?0:1;if(m(E.bounds,a))for(var x=h;x<B;x++){var C=E.parts[x];if(m(C.bounds,a)){var v=d(C,u);if(v){t.push(v);break}}}}return t},e.ray=function(u,o,t,i){i=i||1e-100;for(var a=r.angle(o,t),d=r.magnitude(r.sub(o,t)),m=(t.x+o.x)*.5,P=(t.y+o.y)*.5,E=f.rectangle(m,P,d,i,{angle:a}),B=e.collides(E,u),h=0;h<B.length;h+=1){var x=B[h];x.body=x.bodyB=x.bodyA}return B},e.region=function(u,o,t){for(var i=[],a=0;a<u.length;a++){var d=u[a],m=s.overlaps(d.bounds,o);(m&&!t||!m&&t)&&i.push(d)}return i},e.point=function(u,o){for(var t=[],i=0;i<u.length;i++){var a=u[i];if(s.contains(a.bounds,o))for(var d=a.parts.length===1?0:1;d<a.parts.length;d++){var m=a.parts[d];if(s.contains(m.bounds,o)&&c.contains(m.vertices,o)){t.push(a);break}}}return t}})()},function(p,w,l){var e={};p.exports=e;var r=l(4),n=l(0),s=l(6),f=l(1),c=l(5),u=l(2),o=l(14);(function(){var t,i;typeof window<"u"&&(t=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(h){window.setTimeout(function(){h(n.now())},1e3/60)},i=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame),e._goodFps=30,e._goodDelta=1e3/60,e.create=function(h){var x={engine:null,element:null,canvas:null,mouse:null,frameRequestId:null,timing:{historySize:60,delta:0,deltaHistory:[],lastTime:0,lastTimestamp:0,lastElapsed:0,timestampElapsed:0,timestampElapsedHistory:[],engineDeltaHistory:[],engineElapsedHistory:[],elapsedHistory:[]},options:{width:800,height:600,pixelRatio:1,background:"#14151f",wireframeBackground:"#14151f",hasBounds:!!h.bounds,enabled:!0,wireframes:!0,showSleeping:!0,showDebug:!1,showStats:!1,showPerformance:!1,showBounds:!1,showVelocity:!1,showCollisions:!1,showSeparations:!1,showAxes:!1,showPositions:!1,showAngleIndicator:!1,showIds:!1,showVertexNumbers:!1,showConvexHulls:!1,showInternalEdges:!1,showMousePosition:!1}},C=n.extend(x,h);return C.canvas&&(C.canvas.width=C.options.width||C.canvas.width,C.canvas.height=C.options.height||C.canvas.height),C.mouse=h.mouse,C.engine=h.engine,C.canvas=C.canvas||m(C.options.width,C.options.height),C.context=C.canvas.getContext("2d"),C.textures={},C.bounds=C.bounds||{min:{x:0,y:0},max:{x:C.canvas.width,y:C.canvas.height}},C.controller=e,C.options.showBroadphase=!1,C.options.pixelRatio!==1&&e.setPixelRatio(C,C.options.pixelRatio),n.isElement(C.element)&&C.element.appendChild(C.canvas),C},e.run=function(h){(function x(C){h.frameRequestId=t(x),a(h,C),e.world(h,C),(h.options.showStats||h.options.showDebug)&&e.stats(h,h.context,C),(h.options.showPerformance||h.options.showDebug)&&e.performance(h,h.context,C)})()},e.stop=function(h){i(h.frameRequestId)},e.setPixelRatio=function(h,x){var C=h.options,v=h.canvas;x==="auto"&&(x=P(v)),C.pixelRatio=x,v.setAttribute("data-pixel-ratio",x),v.width=C.width*x,v.height=C.height*x,v.style.width=C.width+"px",v.style.height=C.height+"px"},e.lookAt=function(h,x,C,v){v=typeof v<"u"?v:!0,x=n.isArray(x)?x:[x],C=C||{x:0,y:0};for(var M={min:{x:1/0,y:1/0},max:{x:-1/0,y:-1/0}},I=0;I<x.length;I+=1){var b=x[I],L=b.bounds?b.bounds.min:b.min||b.position||b,A=b.bounds?b.bounds.max:b.max||b.position||b;L&&A&&(L.x<M.min.x&&(M.min.x=L.x),A.x>M.max.x&&(M.max.x=A.x),L.y<M.min.y&&(M.min.y=L.y),A.y>M.max.y&&(M.max.y=A.y))}var k=M.max.x-M.min.x+2*C.x,D=M.max.y-M.min.y+2*C.y,z=h.canvas.height,O=h.canvas.width,N=O/z,W=k/D,G=1,Y=1;W>N?Y=W/N:G=N/W,h.options.hasBounds=!0,h.bounds.min.x=M.min.x,h.bounds.max.x=M.min.x+k*G,h.bounds.min.y=M.min.y,h.bounds.max.y=M.min.y+D*Y,v&&(h.bounds.min.x+=k*.5-k*G*.5,h.bounds.max.x+=k*.5-k*G*.5,h.bounds.min.y+=D*.5-D*Y*.5,h.bounds.max.y+=D*.5-D*Y*.5),h.bounds.min.x-=C.x,h.bounds.max.x-=C.x,h.bounds.min.y-=C.y,h.bounds.max.y-=C.y,h.mouse&&(o.setScale(h.mouse,{x:(h.bounds.max.x-h.bounds.min.x)/h.canvas.width,y:(h.bounds.max.y-h.bounds.min.y)/h.canvas.height}),o.setOffset(h.mouse,h.bounds.min))},e.startViewTransform=function(h){var x=h.bounds.max.x-h.bounds.min.x,C=h.bounds.max.y-h.bounds.min.y,v=x/h.options.width,M=C/h.options.height;h.context.setTransform(h.options.pixelRatio/v,0,0,h.options.pixelRatio/M,0,0),h.context.translate(-h.bounds.min.x,-h.bounds.min.y)},e.endViewTransform=function(h){h.context.setTransform(h.options.pixelRatio,0,0,h.options.pixelRatio,0,0)},e.world=function(h,x){var C=n.now(),v=h.engine,M=v.world,I=h.canvas,b=h.context,L=h.options,A=h.timing,k=s.allBodies(M),D=s.allConstraints(M),z=L.wireframes?L.wireframeBackground:L.background,O=[],N=[],W,G={timestamp:v.timing.timestamp};if(c.trigger(h,"beforeRender",G),h.currentBackground!==z&&B(h,z),b.globalCompositeOperation="source-in",b.fillStyle="transparent",b.fillRect(0,0,I.width,I.height),b.globalCompositeOperation="source-over",L.hasBounds){for(W=0;W<k.length;W++){var Y=k[W];f.overlaps(Y.bounds,h.bounds)&&O.push(Y)}for(W=0;W<D.length;W++){var V=D[W],X=V.bodyA,Z=V.bodyB,ee=V.pointA,K=V.pointB;X&&(ee=u.add(X.position,V.pointA)),Z&&(K=u.add(Z.position,V.pointB)),!(!ee||!K)&&(f.contains(h.bounds,ee)||f.contains(h.bounds,K))&&N.push(V)}e.startViewTransform(h),h.mouse&&(o.setScale(h.mouse,{x:(h.bounds.max.x-h.bounds.min.x)/h.options.width,y:(h.bounds.max.y-h.bounds.min.y)/h.options.height}),o.setOffset(h.mouse,h.bounds.min))}else N=D,O=k,h.options.pixelRatio!==1&&h.context.setTransform(h.options.pixelRatio,0,0,h.options.pixelRatio,0,0);!L.wireframes||v.enableSleeping&&L.showSleeping?e.bodies(h,O,b):(L.showConvexHulls&&e.bodyConvexHulls(h,O,b),e.bodyWireframes(h,O,b)),L.showBounds&&e.bodyBounds(h,O,b),(L.showAxes||L.showAngleIndicator)&&e.bodyAxes(h,O,b),L.showPositions&&e.bodyPositions(h,O,b),L.showVelocity&&e.bodyVelocity(h,O,b),L.showIds&&e.bodyIds(h,O,b),L.showSeparations&&e.separations(h,v.pairs.list,b),L.showCollisions&&e.collisions(h,v.pairs.list,b),L.showVertexNumbers&&e.vertexNumbers(h,O,b),L.showMousePosition&&e.mousePosition(h,h.mouse,b),e.constraints(N,b),L.hasBounds&&e.endViewTransform(h),c.trigger(h,"afterRender",G),A.lastElapsed=n.now()-C},e.stats=function(h,x,C){for(var v=h.engine,M=v.world,I=s.allBodies(M),b=0,L=55,A=44,k=0,D=0,z=0;z<I.length;z+=1)b+=I[z].parts.length;var O={Part:b,Body:I.length,Cons:s.allConstraints(M).length,Comp:s.allComposites(M).length,Pair:v.pairs.list.length};x.fillStyle="#0e0f19",x.fillRect(k,D,L*5.5,A),x.font="12px Arial",x.textBaseline="top",x.textAlign="right";for(var N in O){var W=O[N];x.fillStyle="#aaa",x.fillText(N,k+L,D+8),x.fillStyle="#eee",x.fillText(W,k+L,D+26),k+=L}},e.performance=function(h,x){var C=h.engine,v=h.timing,M=v.deltaHistory,I=v.elapsedHistory,b=v.timestampElapsedHistory,L=v.engineDeltaHistory,A=v.engineElapsedHistory,k=C.timing.lastDelta,D=d(M),z=d(I),O=d(L),N=d(A),W=d(b),G=W/D||0,Y=1e3/D||0,V=4,X=12,Z=60,ee=34,K=10,ne=69;x.fillStyle="#0e0f19",x.fillRect(0,50,X*4+Z*5+22,ee),e.status(x,K,ne,Z,V,M.length,Math.round(Y)+" fps",Y/e._goodFps,function(j){return M[j]/D-1}),e.status(x,K+X+Z,ne,Z,V,L.length,k.toFixed(2)+" dt",e._goodDelta/k,function(j){return L[j]/O-1}),e.status(x,K+(X+Z)*2,ne,Z,V,A.length,N.toFixed(2)+" ut",1-N/e._goodFps,function(j){return A[j]/N-1}),e.status(x,K+(X+Z)*3,ne,Z,V,I.length,z.toFixed(2)+" rt",1-z/e._goodFps,function(j){return I[j]/z-1}),e.status(x,K+(X+Z)*4,ne,Z,V,b.length,G.toFixed(2)+" x",G*G*G,function(j){return(b[j]/M[j]/G||0)-1})},e.status=function(h,x,C,v,M,I,b,L,A){h.strokeStyle="#888",h.fillStyle="#444",h.lineWidth=1,h.fillRect(x,C+7,v,1),h.beginPath(),h.moveTo(x,C+7-M*n.clamp(.4*A(0),-2,2));for(var k=0;k<v;k+=1)h.lineTo(x+k,C+7-(k<I?M*n.clamp(.4*A(k),-2,2):0));h.stroke(),h.fillStyle="hsl("+n.clamp(25+95*L,0,120)+",100%,60%)",h.fillRect(x,C-7,4,4),h.font="12px Arial",h.textBaseline="middle",h.textAlign="right",h.fillStyle="#eee",h.fillText(b,x+v,C-5)},e.constraints=function(h,x){for(var C=x,v=0;v<h.length;v++){var M=h[v];if(!(!M.render.visible||!M.pointA||!M.pointB)){var I=M.bodyA,b=M.bodyB,L,A;if(I?L=u.add(I.position,M.pointA):L=M.pointA,M.render.type==="pin")C.beginPath(),C.arc(L.x,L.y,3,0,2*Math.PI),C.closePath();else{if(b?A=u.add(b.position,M.pointB):A=M.pointB,C.beginPath(),C.moveTo(L.x,L.y),M.render.type==="spring")for(var k=u.sub(A,L),D=u.perp(u.normalise(k)),z=Math.ceil(n.clamp(M.length/5,12,20)),O,N=1;N<z;N+=1)O=N%2===0?1:-1,C.lineTo(L.x+k.x*(N/z)+D.x*O*4,L.y+k.y*(N/z)+D.y*O*4);C.lineTo(A.x,A.y)}M.render.lineWidth&&(C.lineWidth=M.render.lineWidth,C.strokeStyle=M.render.strokeStyle,C.stroke()),M.render.anchors&&(C.fillStyle=M.render.strokeStyle,C.beginPath(),C.arc(L.x,L.y,3,0,2*Math.PI),C.arc(A.x,A.y,3,0,2*Math.PI),C.closePath(),C.fill())}}},e.bodies=function(h,x,C){var v=C;h.engine;var M=h.options,I=M.showInternalEdges||!M.wireframes,b,L,A,k;for(A=0;A<x.length;A++)if(b=x[A],!!b.render.visible){for(k=b.parts.length>1?1:0;k<b.parts.length;k++)if(L=b.parts[k],!!L.render.visible){if(M.showSleeping&&b.isSleeping?v.globalAlpha=.5*L.render.opacity:L.render.opacity!==1&&(v.globalAlpha=L.render.opacity),L.render.sprite&&L.render.sprite.texture&&!M.wireframes){var D=L.render.sprite,z=E(h,D.texture);v.translate(L.position.x,L.position.y),v.rotate(L.angle),v.drawImage(z,z.width*-D.xOffset*D.xScale,z.height*-D.yOffset*D.yScale,z.width*D.xScale,z.height*D.yScale),v.rotate(-L.angle),v.translate(-L.position.x,-L.position.y)}else{if(L.circleRadius)v.beginPath(),v.arc(L.position.x,L.position.y,L.circleRadius,0,2*Math.PI);else{v.beginPath(),v.moveTo(L.vertices[0].x,L.vertices[0].y);for(var O=1;O<L.vertices.length;O++)!L.vertices[O-1].isInternal||I?v.lineTo(L.vertices[O].x,L.vertices[O].y):v.moveTo(L.vertices[O].x,L.vertices[O].y),L.vertices[O].isInternal&&!I&&v.moveTo(L.vertices[(O+1)%L.vertices.length].x,L.vertices[(O+1)%L.vertices.length].y);v.lineTo(L.vertices[0].x,L.vertices[0].y),v.closePath()}M.wireframes?(v.lineWidth=1,v.strokeStyle="#bbb",v.stroke()):(v.fillStyle=L.render.fillStyle,L.render.lineWidth&&(v.lineWidth=L.render.lineWidth,v.strokeStyle=L.render.strokeStyle,v.stroke()),v.fill())}v.globalAlpha=1}}},e.bodyWireframes=function(h,x,C){var v=C,M=h.options.showInternalEdges,I,b,L,A,k;for(v.beginPath(),L=0;L<x.length;L++)if(I=x[L],!!I.render.visible)for(k=I.parts.length>1?1:0;k<I.parts.length;k++){for(b=I.parts[k],v.moveTo(b.vertices[0].x,b.vertices[0].y),A=1;A<b.vertices.length;A++)!b.vertices[A-1].isInternal||M?v.lineTo(b.vertices[A].x,b.vertices[A].y):v.moveTo(b.vertices[A].x,b.vertices[A].y),b.vertices[A].isInternal&&!M&&v.moveTo(b.vertices[(A+1)%b.vertices.length].x,b.vertices[(A+1)%b.vertices.length].y);v.lineTo(b.vertices[0].x,b.vertices[0].y)}v.lineWidth=1,v.strokeStyle="#bbb",v.stroke()},e.bodyConvexHulls=function(h,x,C){var v=C,M,I,b;for(v.beginPath(),I=0;I<x.length;I++)if(M=x[I],!(!M.render.visible||M.parts.length===1)){for(v.moveTo(M.vertices[0].x,M.vertices[0].y),b=1;b<M.vertices.length;b++)v.lineTo(M.vertices[b].x,M.vertices[b].y);v.lineTo(M.vertices[0].x,M.vertices[0].y)}v.lineWidth=1,v.strokeStyle="rgba(255,255,255,0.2)",v.stroke()},e.vertexNumbers=function(h,x,C){var v=C,M,I,b;for(M=0;M<x.length;M++){var L=x[M].parts;for(b=L.length>1?1:0;b<L.length;b++){var A=L[b];for(I=0;I<A.vertices.length;I++)v.fillStyle="rgba(255,255,255,0.2)",v.fillText(M+"_"+I,A.position.x+(A.vertices[I].x-A.position.x)*.8,A.position.y+(A.vertices[I].y-A.position.y)*.8)}}},e.mousePosition=function(h,x,C){var v=C;v.fillStyle="rgba(255,255,255,0.8)",v.fillText(x.position.x+"  "+x.position.y,x.position.x+5,x.position.y-5)},e.bodyBounds=function(h,x,C){var v=C;h.engine;var M=h.options;v.beginPath();for(var I=0;I<x.length;I++){var b=x[I];if(b.render.visible)for(var L=x[I].parts,A=L.length>1?1:0;A<L.length;A++){var k=L[A];v.rect(k.bounds.min.x,k.bounds.min.y,k.bounds.max.x-k.bounds.min.x,k.bounds.max.y-k.bounds.min.y)}}M.wireframes?v.strokeStyle="rgba(255,255,255,0.08)":v.strokeStyle="rgba(0,0,0,0.1)",v.lineWidth=1,v.stroke()},e.bodyAxes=function(h,x,C){var v=C;h.engine;var M=h.options,I,b,L,A;for(v.beginPath(),b=0;b<x.length;b++){var k=x[b],D=k.parts;if(k.render.visible)if(M.showAxes)for(L=D.length>1?1:0;L<D.length;L++)for(I=D[L],A=0;A<I.axes.length;A++){var z=I.axes[A];v.moveTo(I.position.x,I.position.y),v.lineTo(I.position.x+z.x*20,I.position.y+z.y*20)}else for(L=D.length>1?1:0;L<D.length;L++)for(I=D[L],A=0;A<I.axes.length;A++)v.moveTo(I.position.x,I.position.y),v.lineTo((I.vertices[0].x+I.vertices[I.vertices.length-1].x)/2,(I.vertices[0].y+I.vertices[I.vertices.length-1].y)/2)}M.wireframes?(v.strokeStyle="indianred",v.lineWidth=1):(v.strokeStyle="rgba(255, 255, 255, 0.4)",v.globalCompositeOperation="overlay",v.lineWidth=2),v.stroke(),v.globalCompositeOperation="source-over"},e.bodyPositions=function(h,x,C){var v=C;h.engine;var M=h.options,I,b,L,A;for(v.beginPath(),L=0;L<x.length;L++)if(I=x[L],!!I.render.visible)for(A=0;A<I.parts.length;A++)b=I.parts[A],v.arc(b.position.x,b.position.y,3,0,2*Math.PI,!1),v.closePath();for(M.wireframes?v.fillStyle="indianred":v.fillStyle="rgba(0,0,0,0.5)",v.fill(),v.beginPath(),L=0;L<x.length;L++)I=x[L],I.render.visible&&(v.arc(I.positionPrev.x,I.positionPrev.y,2,0,2*Math.PI,!1),v.closePath());v.fillStyle="rgba(255,165,0,0.8)",v.fill()},e.bodyVelocity=function(h,x,C){var v=C;v.beginPath();for(var M=0;M<x.length;M++){var I=x[M];if(I.render.visible){var b=r.getVelocity(I);v.moveTo(I.position.x,I.position.y),v.lineTo(I.position.x+b.x,I.position.y+b.y)}}v.lineWidth=3,v.strokeStyle="cornflowerblue",v.stroke()},e.bodyIds=function(h,x,C){var v=C,M,I;for(M=0;M<x.length;M++)if(x[M].render.visible){var b=x[M].parts;for(I=b.length>1?1:0;I<b.length;I++){var L=b[I];v.font="12px Arial",v.fillStyle="rgba(255,255,255,0.5)",v.fillText(L.id,L.position.x+10,L.position.y-10)}}},e.collisions=function(h,x,C){var v=C,M=h.options,I,b,L,A;for(v.beginPath(),L=0;L<x.length;L++)if(I=x[L],!!I.isActive)for(b=I.collision,A=0;A<I.activeContacts.length;A++){var k=I.activeContacts[A],D=k.vertex;v.rect(D.x-1.5,D.y-1.5,3.5,3.5)}for(M.wireframes?v.fillStyle="rgba(255,255,255,0.7)":v.fillStyle="orange",v.fill(),v.beginPath(),L=0;L<x.length;L++)if(I=x[L],!!I.isActive&&(b=I.collision,I.activeContacts.length>0)){var z=I.activeContacts[0].vertex.x,O=I.activeContacts[0].vertex.y;I.activeContacts.length===2&&(z=(I.activeContacts[0].vertex.x+I.activeContacts[1].vertex.x)/2,O=(I.activeContacts[0].vertex.y+I.activeContacts[1].vertex.y)/2),b.bodyB===b.supports[0].body||b.bodyA.isStatic===!0?v.moveTo(z-b.normal.x*8,O-b.normal.y*8):v.moveTo(z+b.normal.x*8,O+b.normal.y*8),v.lineTo(z,O)}M.wireframes?v.strokeStyle="rgba(255,165,0,0.7)":v.strokeStyle="orange",v.lineWidth=1,v.stroke()},e.separations=function(h,x,C){var v=C,M=h.options,I,b,L,A,k;for(v.beginPath(),k=0;k<x.length;k++)if(I=x[k],!!I.isActive){b=I.collision,L=b.bodyA,A=b.bodyB;var D=1;!A.isStatic&&!L.isStatic&&(D=.5),A.isStatic&&(D=0),v.moveTo(A.position.x,A.position.y),v.lineTo(A.position.x-b.penetration.x*D,A.position.y-b.penetration.y*D),D=1,!A.isStatic&&!L.isStatic&&(D=.5),L.isStatic&&(D=0),v.moveTo(L.position.x,L.position.y),v.lineTo(L.position.x+b.penetration.x*D,L.position.y+b.penetration.y*D)}M.wireframes?v.strokeStyle="rgba(255,165,0,0.5)":v.strokeStyle="orange",v.stroke()},e.inspector=function(h,x){h.engine;var C=h.selected,v=h.render,M=v.options,I;if(M.hasBounds){var b=v.bounds.max.x-v.bounds.min.x,L=v.bounds.max.y-v.bounds.min.y,A=b/v.options.width,k=L/v.options.height;x.scale(1/A,1/k),x.translate(-v.bounds.min.x,-v.bounds.min.y)}for(var D=0;D<C.length;D++){var z=C[D].data;switch(x.translate(.5,.5),x.lineWidth=1,x.strokeStyle="rgba(255,165,0,0.9)",x.setLineDash([1,2]),z.type){case"body":I=z.bounds,x.beginPath(),x.rect(Math.floor(I.min.x-3),Math.floor(I.min.y-3),Math.floor(I.max.x-I.min.x+6),Math.floor(I.max.y-I.min.y+6)),x.closePath(),x.stroke();break;case"constraint":var O=z.pointA;z.bodyA&&(O=z.pointB),x.beginPath(),x.arc(O.x,O.y,10,0,2*Math.PI),x.closePath(),x.stroke();break}x.setLineDash([]),x.translate(-.5,-.5)}h.selectStart!==null&&(x.translate(.5,.5),x.lineWidth=1,x.strokeStyle="rgba(255,165,0,0.6)",x.fillStyle="rgba(255,165,0,0.1)",I=h.selectBounds,x.beginPath(),x.rect(Math.floor(I.min.x),Math.floor(I.min.y),Math.floor(I.max.x-I.min.x),Math.floor(I.max.y-I.min.y)),x.closePath(),x.stroke(),x.fill(),x.translate(-.5,-.5)),M.hasBounds&&x.setTransform(1,0,0,1,0,0)};var a=function(h,x){var C=h.engine,v=h.timing,M=v.historySize,I=C.timing.timestamp;v.delta=x-v.lastTime||e._goodDelta,v.lastTime=x,v.timestampElapsed=I-v.lastTimestamp||0,v.lastTimestamp=I,v.deltaHistory.unshift(v.delta),v.deltaHistory.length=Math.min(v.deltaHistory.length,M),v.engineDeltaHistory.unshift(C.timing.lastDelta),v.engineDeltaHistory.length=Math.min(v.engineDeltaHistory.length,M),v.timestampElapsedHistory.unshift(v.timestampElapsed),v.timestampElapsedHistory.length=Math.min(v.timestampElapsedHistory.length,M),v.engineElapsedHistory.unshift(C.timing.lastElapsed),v.engineElapsedHistory.length=Math.min(v.engineElapsedHistory.length,M),v.elapsedHistory.unshift(v.lastElapsed),v.elapsedHistory.length=Math.min(v.elapsedHistory.length,M)},d=function(h){for(var x=0,C=0;C<h.length;C+=1)x+=h[C];return x/h.length||0},m=function(h,x){var C=document.createElement("canvas");return C.width=h,C.height=x,C.oncontextmenu=function(){return!1},C.onselectstart=function(){return!1},C},P=function(h){var x=h.getContext("2d"),C=window.devicePixelRatio||1,v=x.webkitBackingStorePixelRatio||x.mozBackingStorePixelRatio||x.msBackingStorePixelRatio||x.oBackingStorePixelRatio||x.backingStorePixelRatio||1;return C/v},E=function(h,x){var C=h.textures[x];return C||(C=h.textures[x]=new Image,C.src=x,C)},B=function(h,x){var C=x;/(jpg|gif|png)$/.test(x)&&(C="url("+x+")"),h.canvas.style.background=C,h.canvas.style.backgroundSize="contain",h.currentBackground=x}})()},function(p,w,l){var e={};p.exports=e;var r=l(5),n=l(17),s=l(0);(function(){var f,c;if(typeof window<"u"&&(f=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame,c=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame),!f){var u;f=function(o){u=setTimeout(function(){o(s.now())},1e3/60)},c=function(){clearTimeout(u)}}e.create=function(o){var t={fps:60,deltaSampleSize:60,counterTimestamp:0,frameCounter:0,deltaHistory:[],timePrev:null,frameRequestId:null,isFixed:!1,enabled:!0},i=s.extend(t,o);return i.delta=i.delta||1e3/i.fps,i.deltaMin=i.deltaMin||1e3/i.fps,i.deltaMax=i.deltaMax||1e3/(i.fps*.5),i.fps=1e3/i.delta,i},e.run=function(o,t){return typeof o.positionIterations<"u"&&(t=o,o=e.create()),function i(a){o.frameRequestId=f(i),a&&o.enabled&&e.tick(o,t,a)}(),o},e.tick=function(o,t,i){var a=t.timing,d;o.isFixed?d=o.delta:(d=i-o.timePrev||o.delta,o.timePrev=i,o.deltaHistory.push(d),o.deltaHistory=o.deltaHistory.slice(-o.deltaSampleSize),d=Math.min.apply(null,o.deltaHistory),d=d<o.deltaMin?o.deltaMin:d,d=d>o.deltaMax?o.deltaMax:d,o.delta=d);var m={timestamp:a.timestamp};r.trigger(o,"beforeTick",m),o.frameCounter+=1,i-o.counterTimestamp>=1e3&&(o.fps=o.frameCounter*((i-o.counterTimestamp)/1e3),o.counterTimestamp=i,o.frameCounter=0),r.trigger(o,"tick",m),r.trigger(o,"beforeUpdate",m),n.update(t,d),r.trigger(o,"afterUpdate",m),r.trigger(o,"afterTick",m)},e.stop=function(o){c(o.frameRequestId)},e.start=function(o,t){e.run(o,t)}})()},function(p,w,l){var e={};p.exports=e;var r=l(8),n=l(0),s=n.deprecated;(function(){e.collides=function(f,c){return r.collides(f,c)},s(e,"collides","SAT.collides ➤ replaced by Collision.collides")})()},function(p,w,l){var e={};p.exports=e,l(1);var r=l(0);(function(){e.pathToVertices=function(n,s){typeof window<"u"&&!("SVGPathSeg"in window)&&r.warn("Svg.pathToVertices: SVGPathSeg not defined, a polyfill is required.");var f,c,u,o,t,i,a,d,m,P,E=[],B,h,x=0,C=0,v=0;s=s||15;var M=function(b,L,A){var k=A%2===1&&A>1;if(!m||b!=m.x||L!=m.y){m&&k?(B=m.x,h=m.y):(B=0,h=0);var D={x:B+b,y:h+L};(k||!m)&&(m=D),E.push(D),C=B+b,v=h+L}},I=function(b){var L=b.pathSegTypeAsLetter.toUpperCase();if(L!=="Z"){switch(L){case"M":case"L":case"T":case"C":case"S":case"Q":C=b.x,v=b.y;break;case"H":C=b.x;break;case"V":v=b.y;break}M(C,v,b.pathSegType)}};for(e._svgPathToAbsolute(n),u=n.getTotalLength(),i=[],f=0;f<n.pathSegList.numberOfItems;f+=1)i.push(n.pathSegList.getItem(f));for(a=i.concat();x<u;){if(P=n.getPathSegAtLength(x),t=i[P],t!=d){for(;a.length&&a[0]!=t;)I(a.shift());d=t}switch(t.pathSegTypeAsLetter.toUpperCase()){case"C":case"T":case"S":case"Q":case"A":o=n.getPointAtLength(x),M(o.x,o.y,0);break}x+=s}for(f=0,c=a.length;f<c;++f)I(a[f]);return E},e._svgPathToAbsolute=function(n){for(var s,f,c,u,o,t,i=n.pathSegList,a=0,d=0,m=i.numberOfItems,P=0;P<m;++P){var E=i.getItem(P),B=E.pathSegTypeAsLetter;if(/[MLHVCSQTA]/.test(B))"x"in E&&(a=E.x),"y"in E&&(d=E.y);else switch("x1"in E&&(c=a+E.x1),"x2"in E&&(o=a+E.x2),"y1"in E&&(u=d+E.y1),"y2"in E&&(t=d+E.y2),"x"in E&&(a+=E.x),"y"in E&&(d+=E.y),B){case"m":i.replaceItem(n.createSVGPathSegMovetoAbs(a,d),P);break;case"l":i.replaceItem(n.createSVGPathSegLinetoAbs(a,d),P);break;case"h":i.replaceItem(n.createSVGPathSegLinetoHorizontalAbs(a),P);break;case"v":i.replaceItem(n.createSVGPathSegLinetoVerticalAbs(d),P);break;case"c":i.replaceItem(n.createSVGPathSegCurvetoCubicAbs(a,d,c,u,o,t),P);break;case"s":i.replaceItem(n.createSVGPathSegCurvetoCubicSmoothAbs(a,d,o,t),P);break;case"q":i.replaceItem(n.createSVGPathSegCurvetoQuadraticAbs(a,d,c,u),P);break;case"t":i.replaceItem(n.createSVGPathSegCurvetoQuadraticSmoothAbs(a,d),P);break;case"a":i.replaceItem(n.createSVGPathSegArcAbs(a,d,E.r1,E.r2,E.angle,E.largeArcFlag,E.sweepFlag),P);break;case"z":case"Z":a=s,d=f;break}(B=="M"||B=="m")&&(s=a,f=d)}}})()},function(p,w,l){var e={};p.exports=e;var r=l(6);l(0),function(){e.create=r.create,e.add=r.add,e.remove=r.remove,e.clear=r.clear,e.addComposite=r.addComposite,e.addBody=r.addBody,e.addConstraint=r.addConstraint}()}])})})(Ce);var be=Ce.exports;const U=Te(be),F={engine:null,render:null,world:null,runner:null,isInitialized:!1,isRunning:!1,init:function(g,y,p){if(F.isInitialized){F.render&&(F.render.options.width!==y||F.render.options.height!==p)&&(console.log(`Resizing physics renderer to ${y}x${p}`),F.render.bounds.max.x=y,F.render.bounds.max.y=p,F.render.options.width=y,F.render.options.height=p,F.render.canvas.width=y,F.render.canvas.height=p,F.updateWallPositions(y,p)),F.start();return}if(console.log(`Initializing Physics Engine: ${y}x${p}`),!g||isNaN(y)||isNaN(p)||y<=0||p<=0){console.error("Cannot initialize Physics: Invalid canvas or dimensions.");return}const w={enableSleeping:!0,positionIterations:8,velocityIterations:6};F.engine=U.Engine.create(w),F.world=F.engine.world,F.engine.world.gravity.y=.7,F.render=U.Render.create({element:g.parentNode,canvas:g,engine:F.engine,options:{width:y,height:p,wireframes:!1,background:"transparent",showSleeping:!1,pixelRatio:window.devicePixelRatio||1}}),F.createWalls(y,p),F.runner=U.Runner.create(),U.Runner.run(F.runner,F.engine),U.Render.run(F.render),F.isInitialized=!0,F.isRunning=!0,console.log("Physics engine initialized and running.")},createWalls:function(g,y){if(!F.world)return;const p=U.Composite.allBodies(F.world).filter(s=>s.isStatic);p.length>0&&U.World.remove(F.world,p);const w=R.SAND_COLORS.length,l=g/w,e=15,r=[],n={isStatic:!0,friction:.6,restitution:.1,render:{visible:!1}};r.push(U.Bodies.rectangle(g/2,y+e/2,g+e*2,e,n)),r.push(U.Bodies.rectangle(-15/2,y/2,e,y+e*2,n)),r.push(U.Bodies.rectangle(g+e/2,y/2,e,y+e*2,n));for(let s=1;s<w;s++){const f=s*l;r.push(U.Bodies.rectangle(f,y/2,e,y+e*2,n))}U.World.add(F.world,r)},updateWallPositions:function(g,y){F.createWalls(g,y)},addParticle:function(g,y){var t,i,a;if(!F.isInitialized||!F.engine||!((i=(t=F.render)==null?void 0:t.options)!=null&&i.width)||g<0||g>=R.SAND_COLORS.length)return;const p=R.SAND_COLORS.length,w=F.render.options.width/p,l=((a=S.preferences)==null?void 0:a.sandParticleSize)||5,e=15,r=l*.5,n=g*w,s=n+e/2+l+r,f=n+w-e/2-l-r;if(s>=f)return;const c=s+Math.random()*(f-s),u=-l*2,o=U.Bodies.polygon(c,u,6,l,{restitution:.15,friction:.7,frictionAir:.01,density:.01,render:{fillStyle:y},sleepThreshold:60});U.Body.setVelocity(o,{x:(Math.random()-.5)*.1,y:Math.random()*.1}),U.Body.setAngularVelocity(o,(Math.random()-.5)*.01),U.World.add(F.world,o)},clearDynamicBodies:function(){if(!F.world)return;const y=U.Composite.allBodies(F.world).filter(p=>!p.isStatic);y.length>0&&U.World.remove(F.world,y)},stop:function(){F.isRunning&&(F.runner&&U.Runner.stop(F.runner),F.render&&U.Render.stop(F.render),F.isRunning=!1)},start:function(){F.isRunning||!F.isInitialized||(F.render&&U.Render.run(F.render),F.runner&&F.engine?(U.Runner.run(F.runner,F.engine),F.isRunning=!0):console.error("Cannot start physics, not initialized."))},destroy:function(){console.log("Destroying physics engine..."),F.stop(),F.world&&U.World.clear(F.world,!1),F.engine&&U.Engine.clear(F.engine),F.engine=null,F.world=null,F.render=null,F.runner=null,F.isInitialized=!1,F.isRunning=!1,console.log("Physics engine destroyed.")}},q={update:function(g){S.preferences.showScheduleCircles?q.renderScheduleCircles():T.scheduleCirclesDisplayEl&&(T.scheduleCirclesDisplayEl.innerHTML="")},renderScheduleCircles:function(){if(!S.preferences.showScheduleCircles||!T.scheduleCirclesDisplayEl){T.scheduleCirclesDisplayEl&&(T.scheduleCirclesDisplayEl.innerHTML="");return}const g=se(),y=H.getCurrentPeriodInfo(g),p=S.getActiveColourScheme(),w=(S.schedule||[]).map((r,n)=>({...r,originalIndex:n})).filter(r=>r.showCircles);if(w.length===0){T.scheduleCirclesDisplayEl.innerHTML="";return}let l=-1;y&&(l=w.findIndex(r=>r.originalIndex===y.index));let e="";for(let r=0;r<w.length;r++){const n=l>=r,s=n?"●":"○",f=`schedule-circle-symbol ${n?"active":"inactive"}`,c=n?p.text:"#555";e+=`<span class="${f}" style="color: ${c};">${s}</span>`}T.scheduleCirclesDisplayEl.innerHTML=e},setupPhysicsSandBars:function(g){var w,l;if(q.stopPhysicsCheckInterval(),F.clearDynamicBodies(),R.physicsParticlesAdded=0,R.totalParticlesForPeriod=0,!S.preferences.showSandBars||!T.sandBarsCanvas||!T.sandBarsContainerEl){F.stop();return}const y=((w=S.preferences)==null?void 0:w.sandHeight)||150,p=((l=S.preferences)==null?void 0:l.sandWidth)||80;T.sandBarsContainerEl.style.height=`${y}px`,T.sandBarsContainerEl.style.width=`${p}%`,requestAnimationFrame(()=>{var d;const e=T.sandBarsContainerEl.offsetWidth,r=T.sandBarsContainerEl.offsetHeight;if(e<=0||r<=0){console.warn("Sand bars container has zero dimensions after rAF. Aborting physics setup."),F.stop();return}const n=((d=S.preferences)==null?void 0:d.sandParticleSize)||5,s=3*Math.sqrt(3)/2*n*n,f=e/R.SAND_COLORS.length,u=Math.max(0,f-15),o=Math.max(0,r-n),t=u*o,i=.85;R.visualMaxParticlesPerSegment=Math.max(10,Math.floor(t*i/s)),R.totalParticlesForPeriod=R.visualMaxParticlesPerSegment*R.SAND_COLORS.length,console.log(`Est. Max Particles Per Segment (Hex): ${R.visualMaxParticlesPerSegment}, Total Target: ${R.totalParticlesForPeriod}, Particle Area: ${s.toFixed(2)}`),F.init(T.sandBarsCanvas,e,r),F.start(),q.handleColorSchemeChange();const a=H.getCurrentPeriodInfo(se());if(a){const m=a.start.getTime();a.end.getTime()-m>0?(q.checkAndAddParticles(),R.physicsCheckIntervalId=setInterval(q.checkAndAddParticles,R.physicsCheckIntervalMs)):(console.log("Period duration is zero or negative, stopping physics."),F.stop())}else console.log("No current period found, stopping physics."),F.stop()})},checkAndAddParticles:function(){if(!S.preferences.showSandBars||!F.isRunning||R.totalParticlesForPeriod<=0){q.stopPhysicsCheckInterval();return}const g=se(),y=H.getCurrentPeriodInfo(g);if(!y){q.stopPhysicsCheckInterval();return}const p=y.start.getTime(),l=y.end.getTime()-p;if(l<=0){q.stopPhysicsCheckInterval();return}const e=Math.max(0,g.getTime()-p),r=Math.min(1,e/l),s=Math.floor(r*R.totalParticlesForPeriod)-R.physicsParticlesAdded,f=5;for(let c=0;c<Math.min(s,f)&&!(R.physicsParticlesAdded>=R.totalParticlesForPeriod);++c){const u=l/R.SAND_COLORS.length,t=(R.physicsParticlesAdded+.5)/R.totalParticlesForPeriod*l,i=Math.min(R.SAND_COLORS.length-1,Math.floor(t/u));i>=0&&(F.addParticle(i,R.SAND_COLORS[i]),R.physicsParticlesAdded++)}R.physicsParticlesAdded>=R.totalParticlesForPeriod&&q.stopPhysicsCheckInterval()},stopPhysicsCheckInterval:function(){R.physicsCheckIntervalId&&(clearInterval(R.physicsCheckIntervalId),R.physicsCheckIntervalId=null)},handlePeriodChange:function(g){console.log("Handling period change for physics sand bars."),q.setupPhysicsSandBars(g)},handleDisplayToggle:function(){console.log("Handling display toggle for physics sand bars.");const g=H.getCurrentPeriodInfo(se());q.setupPhysicsSandBars(g)},handleColorSchemeChange:function(){T.sandBarsContainerEl&&S.getActiveColourScheme().text,S.preferences.showScheduleCircles&&q.renderScheduleCircles()}},ie={update:function(){var e,r,n,s,f;const g=S.preferences;if(!T.clockDisplayArea){console.warn("DOM cache not ready in Layout.update");return}[{el:T.dateEl,pref:"showDate"},{el:T.scheduleCirclesDisplayEl,pref:"showScheduleCircles"},{el:T.timeEl,pref:"showTime"}].forEach(c=>{var u;(u=c.el)==null||u.classList.toggle("element-hidden",!g[c.pref])});const p=g.showScheduleLabel||g.showProgressBar||g.showSandBars;(e=T.periodContainerEl)==null||e.classList.toggle("element-hidden",!p),p?(r=T.periodLabelEl)==null||r.classList.toggle("element-hidden",!g.showScheduleLabel):(n=T.periodLabelEl)==null||n.classList.add("element-hidden");const w=g.showProgressBar&&!g.showSandBars,l=g.showSandBars;(s=T.progressBarEl)==null||s.classList.toggle("element-hidden",!w),(f=T.sandBarsContainerEl)==null||f.classList.toggle("element-hidden",!l),T.sandBarsCanvas&&(T.sandBarsCanvas.style.display=l?"block":"none"),ie.applyFontAndSizePreferences()},applyFontAndSizePreferences:function(){const g=S.preferences;S.getActiveColourScheme(),T.clockDisplayArea&&(g.showDate&&T.dateEl&&(T.dateEl.style.fontSize=g.dateFontSize+"px"),g.showTime&&T.timeEl&&(T.timeEl.style.fontSize=g.timeFontSize+"px"),g.showScheduleLabel&&T.periodLabelEl&&(T.periodLabelEl.style.fontSize=g.scheduleLabelFontSize+"px"),g.showProgressBar&&!g.showSandBars&&(T.timeLeftEl&&(T.timeLeftEl.style.fontSize=g.timeLeftFontSize+"px"),T.progressBarEl&&(T.progressBarEl.style.height=g.progressBarHeight+"px")),document.body.style.fontFamily=g.fontFamily,g.showScheduleCircles&&T.scheduleCirclesDisplayEl&&q.renderScheduleCircles())}},$={attachListeners:function(){var g,y;(g=T.addScheduleRowBtn)==null||g.addEventListener("click",$.addRow),(y=T.deleteScheduleRowBtn)==null||y.addEventListener("click",$.deleteRow)},renderTable:function(){const g=T.scheduleTableBody;if(!g){console.error("Schedule table body not found");return}g.innerHTML="",(S.schedule||[]).forEach((p,w)=>{const l=document.createElement("tr");l.dataset.index=w,l.setAttribute("draggable","true"),w===R.selectedScheduleRowIndex&&l.classList.add("selected"),l.appendChild($.createDragCell()),l.appendChild($.createLabelCell(p,w)),l.appendChild($.createTimeCell(p,w,"start")),l.appendChild($.createTimeCell(p,w,"end")),l.appendChild($.createSchemeCell(p,w)),l.appendChild($.createAlertCell(p,w)),l.appendChild($.createCirclesCell(p,w)),l.addEventListener("click",$.handleRowClick),l.addEventListener("dragstart",$.handleDragStart),l.addEventListener("dragover",$.handleDragOver),l.addEventListener("dragleave",$.handleDragLeave),l.addEventListener("drop",$.handleDrop),l.addEventListener("dragend",$.handleDragEnd),g.appendChild(l)}),g.removeEventListener("dragleave",$.handleTableDragLeave),g.addEventListener("dragleave",$.handleTableDragLeave)},createDragCell:function(){const g=document.createElement("td");return g.innerHTML="☰",g.className="drag-handle",g.title="Drag to reorder",g},createLabelCell:function(g,y){const p=document.createElement("td"),w=document.createElement("input");return w.type="text",w.value=g.label||"",w.placeholder="Period Label",w.addEventListener("change",function(){S.schedule&&S.schedule[y]&&(S.schedule[y].label=this.value,S.save(),H.update())}),p.appendChild(w),p},createTimeCell:function(g,y,p){const w=document.createElement("td"),l=document.createElement("input");return l.type="time",l.value=g[p]||"00:00",l.addEventListener("change",function(){S.schedule&&S.schedule[y]&&(S.schedule[y][p]=this.value,S.save(),H.update())}),w.appendChild(l),w},createSchemeCell:function(g,y){var r;const p=document.createElement("td"),w=document.createElement("div");w.className="scheme-swatch";const l=((r=S.preferences)==null?void 0:r.colourSchemes)||[],e=l.find(n=>n.id===g.colourSchemeId)||l.find(n=>n.id===1)||l[0];return w.style.backgroundColor=e?e.background:"#ff00ff",w.style.borderColor=e?e.text:"#ffffff",w.title=`Scheme: ${e?e.name:"Unknown"} (ID: ${g.colourSchemeId}). Click to cycle.`,w.addEventListener("click",n=>{n.stopPropagation(),$.cycleSchemeForRow(y)}),p.appendChild(w),p},createAlertCell:function(g,y){var e,r;const p=document.createElement("td"),w=document.createElement("button"),l=((r=(e=S.alerts[y])==null?void 0:e.colour)==null?void 0:r.enabled)||!1;return w.innerHTML=l?"🔴":"🟢",w.title=`Visual Alert: ${l?"Enabled":"Disabled"}. Click to edit.`,w.className="alert-edit-btn",w.addEventListener("click",n=>{n.stopPropagation(),Q.openModal(y)}),p.appendChild(w),p.style.textAlign="center",p},createCirclesCell:function(g,y){const p=document.createElement("td"),w=document.createElement("input");return w.type="checkbox",w.checked=g.showCircles||!1,w.title="Show this period in the Schedule Circles display",w.addEventListener("change",function(l){l.stopPropagation(),S.schedule&&S.schedule[y]&&(S.schedule[y].showCircles=this.checked,S.save(),q.renderScheduleCircles())}),p.appendChild(w),p.style.textAlign="center",p},handleRowClick:function(g){var p;const y=parseInt(this.dataset.index,10);if(g.target.tagName==="INPUT"||g.target.tagName==="BUTTON"||g.target.classList.contains("scheme-swatch")||g.target.classList.contains("drag-handle")){if(this.classList.contains("selected")){R.selectedScheduleRowIndex=y;return}}else{const w=(p=T.scheduleTableBody)==null?void 0:p.querySelector("tr.selected");w&&w.classList.remove("selected"),this.classList.add("selected"),R.selectedScheduleRowIndex=y}},cycleSchemeForRow:function(g){var e,r,n;if(!S.schedule||g<0||g>=S.schedule.length)return;const y=S.schedule[g].colourSchemeId||1,p=((e=S.preferences)==null?void 0:e.colourSchemes)||[];if(p.length===0)return;let l=(p.findIndex(s=>s.id===y)+1)%p.length;S.schedule[g].colourSchemeId=((r=p[l])==null?void 0:r.id)||((n=p[0])==null?void 0:n.id)||1,S.save(),$.renderTable(),H.update()},addRow:function(){const g={label:"New Period",start:"00:00",end:"00:00",colourSchemeId:1,showCircles:!1},y=R.selectedScheduleRowIndex===null||R.selectedScheduleRowIndex<0||R.selectedScheduleRowIndex>=S.schedule.length?S.schedule.length:R.selectedScheduleRowIndex+1;S.schedule.splice(y,0,g);const p={};Object.keys(S.alerts).forEach(w=>{const l=parseInt(w,10);p[l>=y?l+1:l]=S.alerts[w]}),S.alerts=p,R.selectedScheduleRowIndex=y,$.renderTable(),S.save()},deleteRow:function(){const g=R.selectedScheduleRowIndex;if(g!==null&&g>=0&&g<S.schedule.length){if(confirm(`Delete row "${S.schedule[g].label}"?`)){S.schedule.splice(g,1),delete S.alerts[g];const y={};Object.keys(S.alerts).forEach(p=>{const w=parseInt(p,10);y[w>g?w-1:w]=S.alerts[p]}),S.alerts=y,R.selectedScheduleRowIndex=null,$.renderTable(),S.save(),H.update()}}else J.showButtonFeedback(T.deleteScheduleRowBtn,"Select Row First!",2e3)},handleDragStart:function(g){var y;if(R.dragStartIndex=parseInt(this.dataset.index,10),!isNaN(R.dragStartIndex)&&(g.dataTransfer.effectAllowed="move",g.dataTransfer.setData("text/plain",R.dragStartIndex),this.classList.add("dragging"),!this.classList.contains("selected"))){const p=(y=T.scheduleTableBody)==null?void 0:y.querySelector("tr.selected");p&&p.classList.remove("selected"),this.classList.add("selected"),R.selectedScheduleRowIndex=R.dragStartIndex}},handleDragOver:function(g){g.preventDefault(),g.dataTransfer.dropEffect="move",this.classList.add("drag-over")},handleDragLeave:function(g){this.classList.remove("drag-over")},handleDrop:function(g){g.preventDefault(),this.classList.remove("drag-over");const y=parseInt(this.dataset.index,10),p=R.dragStartIndex;if(p!==null&&!isNaN(y)&&p!==y){const w=S.schedule.splice(p,1)[0];S.schedule.splice(y,0,w);const l=S.alerts[p],e={};Object.keys(S.alerts).forEach(r=>{const n=parseInt(r,10);if(n===p)return;let s=n;p<n&&y>=n?s--:p>n&&y<=n&&s++,e[s]=S.alerts[r]}),l&&(e[y]=l),S.alerts=e,R.selectedScheduleRowIndex=y,$.renderTable(),S.save(),H.update()}R.dragStartIndex=null},handleDragEnd:function(g){this.classList.remove("dragging"),document.querySelectorAll("#schedule-table tbody tr.drag-over").forEach(y=>{y.classList.remove("drag-over")}),R.dragStartIndex=null},handleTableDragLeave:function(g){T.scheduleTableBody&&!T.scheduleTableBody.contains(g.relatedTarget)&&document.querySelectorAll("#schedule-table tbody tr.drag-over").forEach(y=>{y.classList.remove("drag-over")})}},Q={attachListeners:function(){var g;(g=T.alertModal)==null||g.addEventListener("click",y=>{(y.target===T.alertModal||T.closeModalBtn&&y.target===T.closeModalBtn)&&Q.closeModal()})},openModal:function(g){var p;if(g===null||g<0||!S.schedule||g>=S.schedule.length)return;const y=((p=S.schedule[g])==null?void 0:p.label)||`Row ${g+1}`;T.alertModalTitle&&(T.alertModalTitle.textContent=`Visual Alert Settings for "${y}"`),Q.renderModalForm(g),T.alertModal&&(T.alertModal.style.display="block")},closeModal:function(){T.alertModal&&(T.alertModal.style.display="none"),T.alertModalBody&&(T.alertModalBody.innerHTML="")},renderModalForm:function(g){var f,c,u,o,t,i,a,d;if(!T.alertModalBody||!S.schedule||g>=S.schedule.length)return;const y=((c=(f=S.defaultPreferences)==null?void 0:f.defaultAlertSettings)==null?void 0:c.colour)||{},p=((u=S.alerts[g])==null?void 0:u.colour)||{},w={...y,...p},l=w.durationMs||y.durationMs||1500,e=w.intervalMs||y.intervalMs||500,r=l/1e3,n=!!((o=S.alerts[g])!=null&&o.colour);T.alertModalBody.innerHTML=`
            <div class="alert-settings-form" data-index="${g}">
            <label><input type="checkbox" id="alert-colour-enabled" ${w.enabled?"checked":""}> Enable Visual Alert</label><hr>
            <label>Flash Background Colour: <input type="color" id="alert-bg-color" value="${w.background}"></label>
            <label>Flash Text Colour: <input type="color" id="alert-label-color" value="${w.text}"></label>
            <label>Flash Duration (s): <input type="number" id="alert-flash-duration-sec" min="0.5" max="10" step="0.1" value="${r.toFixed(1)}"></label>
            <label>Flash Interval (ms): <input type="number" id="alert-flash-interval" min="100" max="2000" step="50" value="${e}"></label>
            <div class="button-group">
                <button id="save-alert" data-option="colour">Save Visual Alert</button>
                <button id="preview-alert" data-option="colour">Preview Flash</button>
                <button id="remove-alert" data-option="colour" ${n?"":"disabled"}>${w.enabled?"Disable Alert":n?"Remove Custom Settings":"Using Defaults"}</button>
            </div>
            <div class="feedback-message" style="display: none;"></div></div>`;const s=T.alertModalBody.querySelector(".alert-settings-form");(t=s==null?void 0:s.querySelector("#alert-colour-enabled"))==null||t.addEventListener("change",Q.handleModalEnableToggle),(i=s==null?void 0:s.querySelector("#save-alert"))==null||i.addEventListener("click",Q.handleModalSave),(a=s==null?void 0:s.querySelector("#preview-alert"))==null||a.addEventListener("click",Q.handleModalPreview),(d=s==null?void 0:s.querySelector("#remove-alert"))==null||d.addEventListener("click",Q.handleModalRemove),Q.updateModalControlsState(s,w.enabled,n)},handleModalEnableToggle:function(g){var l;const y=g.target.closest(".alert-settings-form"),p=g.target.checked,w=parseInt(y.dataset.index,10);Q.updateModalControlsState(y,p,!!((l=S.alerts[w])!=null&&l.colour))},updateModalControlsState:function(g,y,p){if(!g)return;const w=g.querySelectorAll('input[type="color"], input[type="number"]'),l=g.querySelector("#preview-alert"),e=g.querySelector("#remove-alert");w.forEach(r=>r.disabled=!y),l&&(l.disabled=!y),e&&(e.disabled=!p,e.textContent=y?"Disable Alert":p?"Remove Custom Settings":"Using Defaults")},handleModalSave:function(){var t,i;const g=this.closest(".alert-settings-form");if(!g)return;const y=parseInt(g.dataset.index,10);if(isNaN(y))return;const p=g.querySelector("#alert-colour-enabled"),w=g.querySelector("#alert-flash-duration-sec"),l=g.querySelector("#alert-flash-interval"),e=g.querySelector("#alert-bg-color"),r=g.querySelector("#alert-label-color");if(g.querySelector(".feedback-message"),!p||!w||!l||!e||!r){console.error("Modal form elements not found for saving.");return}S.alerts[y]||(S.alerts[y]={});const n=((i=(t=S.defaultPreferences)==null?void 0:t.defaultAlertSettings)==null?void 0:i.colour)||{},s=n.durationMs||1500,f=n.intervalMs||500;let c=parseFloat(w.value);c=isNaN(c)?s/1e3:Math.max(.5,Math.min(10,c));let u=parseInt(l.value,10);u=isNaN(u)?f:Math.max(100,Math.min(2e3,u));let o={enabled:p.checked,background:e.value||n.background||"#ff0000",text:r.value||n.text||"#ffffff",durationMs:Math.round(c*1e3),intervalMs:u};S.alerts[y].colour=o,S.save(),$.renderTable(),J.showButtonFeedback(this,"Saved!"),setTimeout(Q.closeModal,1600)},handleModalPreview:function(){var r,n,s,f;const g=this.closest(".alert-settings-form");if(!g)return;const y=g.querySelector("#alert-colour-enabled"),p=g.querySelector(".feedback-message");if(!y||!y.checked){J.showFeedback(p,"Enable the alert first to preview.",!1);return}const w=parseFloat((r=g.querySelector("#alert-flash-duration-sec"))==null?void 0:r.value),l=parseInt((n=g.querySelector("#alert-flash-interval"))==null?void 0:n.value,10);if(isNaN(w)||isNaN(l)){J.showFeedback(p,"Invalid duration or interval value.",!1);return}let e={enabled:!0,background:((s=g.querySelector("#alert-bg-color"))==null?void 0:s.value)||"#ff0000",text:((f=g.querySelector("#alert-label-color"))==null?void 0:f.value)||"#ffffff",durationMs:Math.round(w*1e3),intervalMs:l};Q.triggerVisualAlert(e),J.showFeedback(p,"Previewing flash...",!0)},handleModalRemove:function(){var l;const g=this.closest(".alert-settings-form");if(!g)return;const y=parseInt(g.dataset.index,10),p=g.querySelector("#alert-colour-enabled"),w=g.querySelector(".feedback-message");isNaN(y)||y>=S.schedule.length||((l=S.alerts[y])!=null&&l.colour?p.checked?(p.checked=!1,Q.updateModalControlsState(g,!1,!0),J.showFeedback(w,"Alert disabled. Click Save to confirm.",!0)):confirm(`Remove custom visual alert settings for "${S.schedule[y].label}"? It will revert to defaults.`)&&(delete S.alerts[y].colour,Object.keys(S.alerts[y]).length===0&&delete S.alerts[y],S.save(),$.renderTable(),Q.closeModal()):(J.showFeedback(w,"No custom settings to remove. Using defaults.",!0),this&&(this.disabled=!0,this.textContent="Using Defaults")))},triggerVisualAlert:function(g){var s,f,c,u,o;Q.clearVisualAlert();const{background:y,text:p,durationMs:w,intervalMs:l}=g,e=S.getActiveColourScheme();R.originalBodyStyles={background:document.body.style.backgroundColor,color:document.body.style.color,timeColor:((s=T.timeEl)==null?void 0:s.style.color)||"",dateColor:((f=T.dateEl)==null?void 0:f.style.color)||"",labelColor:((c=T.periodLabelEl)==null?void 0:c.style.color)||"",progressColor:((u=T.progressEl)==null?void 0:u.style.backgroundColor)||"",timeLeftColor:((o=T.timeLeftEl)==null?void 0:o.style.color)||""};let r=!1;const n=()=>{r=!r;const t=r?y:e.background,i=r?p:e.text;document.body.style.backgroundColor=t,document.body.style.color=i,T.timeEl&&S.preferences.showTime&&(T.timeEl.style.color=i),T.dateEl&&S.preferences.showDate&&(T.dateEl.style.color=i),T.periodLabelEl&&S.preferences.showScheduleLabel&&(T.periodLabelEl.style.color=i),T.progressEl&&S.preferences.showProgressBar&&!S.preferences.showSandBars&&(T.progressEl.style.backgroundColor=i),T.timeLeftEl&&S.preferences.showProgressBar&&!S.preferences.showSandBars&&(T.timeLeftEl.style.color=i),T.scheduleCirclesDisplayEl&&S.preferences.showScheduleCircles&&T.scheduleCirclesDisplayEl.querySelectorAll(".schedule-circle-symbol.active").forEach(a=>a.style.color=i)};n(),R.activeVisualAlertInterval=setInterval(n,l),R.activeVisualAlertTimeout=setTimeout(()=>{Q.clearVisualAlert(),Q.restoreOriginalStyles(e)},w)},clearVisualAlert:function(){clearTimeout(R.activeVisualAlertTimeout),clearInterval(R.activeVisualAlertInterval),R.activeVisualAlertInterval=null,R.activeVisualAlertTimeout=null},restoreOriginalStyles:function(g=null){const y=g||S.getActiveColourScheme();document.body.style.backgroundColor=y.background,document.body.style.color=y.text,T.timeEl&&S.preferences.showTime&&(T.timeEl.style.color=y.text),T.dateEl&&S.preferences.showDate&&(T.dateEl.style.color=y.text),T.periodLabelEl&&S.preferences.showScheduleLabel&&(T.periodLabelEl.style.color=y.text),T.progressEl&&S.preferences.showProgressBar&&!S.preferences.showSandBars&&(T.progressEl.style.backgroundColor=y.text),T.timeLeftEl&&S.preferences.showProgressBar&&!S.preferences.showSandBars&&(T.timeLeftEl.style.color=y.text),S.preferences.showScheduleCircles&&q.renderScheduleCircles()}},H={updateIntervalId:null,start:function(){H.updateIntervalId&&clearInterval(H.updateIntervalId),H.updateIntervalId=setInterval(H.update,1e3),H.update(),console.log("Clock started.")},stop:function(){H.updateIntervalId&&(clearInterval(H.updateIntervalId),H.updateIntervalId=null,console.log("Clock stopped."))},getCurrentPeriodInfo:function(g){if(!S.schedule||S.schedule.length===0)return null;for(let y=0;y<S.schedule.length;y++){const p=S.schedule[y];if(!(!p||typeof p.start!="string"||typeof p.end!="string"))try{const w=J.getTodayTime(p.start),l=J.getTodayTime(p.end);let e=new Date(l.getTime()),r=!1;l.getTime()<=w.getTime()&&(r=!0,l.getHours()===0&&l.getMinutes()===0&&l.getSeconds()===0?(e=J.getTodayTime(p.start),e.setDate(e.getDate()+1),e.setHours(0,0,0,0)):e.setDate(e.getDate()+1));let n=!1;if(r){const s=new Date(w);s.setHours(24,0,0,0);const f=new Date(w);f.setDate(f.getDate()+1),f.setHours(0,0,0,0),(g>=w&&g<s||g>=f&&g<e)&&(n=!0)}else g>=w&&g<e&&(n=!0);if(!n&&(p.end==="23:59"||p.end==="23:59:59")){const s=new Date(w);s.setHours(23,59,59,999),g>=w&&g<=s&&(n=!0,e=s)}if(n)return{label:p.label,start:w,end:e,index:y}}catch(w){console.error("Error processing period:",p==null?void 0:p.label,p==null?void 0:p.start,p==null?void 0:p.end,w)}}return null},update:function(){var l,e;if(!S||!ie||!Q||!q||!R||!T){console.error("Core modules not available in Clock.update");return}const g=se(),y=S.getActiveColourScheme();ie.update(),R.activeVisualAlertInterval||Q.restoreOriginalStyles(y),S.preferences.showTime&&T.timeEl&&(T.timeEl.textContent=J.formatTime(g)),S.preferences.showDate&&T.dateEl&&(T.dateEl.textContent=J.formatDate(g)),q.update(g);const p=H.getCurrentPeriodInfo(g),w=p?p.index:null;w!==R.currentPeriodIndex&&(R.currentPeriodLabel=p?p.label:null,R.currentPeriodIndex=w,p&&((e=(l=S.alerts[p.index])==null?void 0:l.colour)!=null&&e.enabled)?Q.triggerVisualAlert(S.alerts[p.index].colour):R.activeVisualAlertInterval&&(Q.clearVisualAlert(),Q.restoreOriginalStyles()),q.handlePeriodChange(p)),H.updatePeriodDisplay(g,p)},updatePeriodDisplay:function(g,y){if(T.periodLabelEl)if(y)if(S.preferences.showScheduleLabel?T.periodLabelEl.textContent=y.label:T.periodLabelEl.textContent="",S.preferences.showProgressBar&&!S.preferences.showSandBars){if(T.progressEl&&T.progressBarEl&&T.timeLeftEl){const p=y.start.getTime(),w=y.end.getTime(),l=g.getTime(),e=w-p,r=Math.max(0,l-p);if(e>0){const n=Math.min(100,Math.max(0,r/e*100));T.progressEl.style.width=n+"%";const s=T.progressBarEl.offsetWidth,f=T.timeLeftEl.offsetWidth>0?T.timeLeftEl.offsetWidth:60;let c=n/100*s-f/2;c=Math.max(0,Math.min(s-f,c)),T.timeLeftEl.style.left=c+"px";const u=Math.max(0,w-l),o=Math.floor(u/1e3),t=Math.floor(o/60),i=o%60;T.timeLeftEl.textContent=`${t}:${i<10?"0"+i:i}`}else{T.progressEl.style.width=l>=p?"100%":"0%",T.timeLeftEl.textContent="0:00";const n=T.progressBarEl.offsetWidth,s=T.timeLeftEl.offsetWidth>0?T.timeLeftEl.offsetWidth:60;T.timeLeftEl.style.left=`${n-s}px`}}}else T.progressEl&&(T.progressEl.style.width="0%"),T.timeLeftEl&&(T.timeLeftEl.textContent="");else T.periodLabelEl&&(T.periodLabelEl.textContent=""),T.progressEl&&S.preferences.showProgressBar&&(T.progressEl.style.width="0%"),T.timeLeftEl&&S.preferences.showProgressBar&&(T.timeLeftEl.textContent="")}},S={schedule:[{label:"Before",start:"00:00",end:"08:50",colourSchemeId:1,showCircles:!1},{label:"Period 1",start:"08:50",end:"10:05",colourSchemeId:1,showCircles:!0},{label:"Break",start:"10:05",end:"10:15",colourSchemeId:2,showCircles:!1},{label:"Period 2",start:"10:15",end:"11:30",colourSchemeId:1,showCircles:!0},{label:"Lunch",start:"11:30",end:"12:20",colourSchemeId:2,showCircles:!1},{label:"Period 3",start:"12:20",end:"13:35",colourSchemeId:1,showCircles:!0},{label:"Break",start:"13:35",end:"13:45",colourSchemeId:2,showCircles:!1},{label:"Period 4",start:"13:45",end:"15:00",colourSchemeId:1,showCircles:!0},{label:"After",start:"15:00",end:"23:59",colourSchemeId:1,showCircles:!1}],preferences:{},alerts:{},defaultPreferences:{fontFamily:"Atkinson Hyperlegible",dateFontSize:64,timeFontSize:200,scheduleLabelFontSize:48,timeLeftFontSize:40,progressBarHeight:120,timeOffsetMs:0,showDate:!0,showTime:!0,showScheduleLabel:!0,showProgressBar:!0,showScheduleCircles:!1,showSandBars:!1,sandWidth:80,sandHeight:150,sandParticleSize:5,colourSchemes:[{id:1,name:"Default Dark",background:"#000000",text:"#FFFFFF"},{id:2,name:"Default Light",background:"#F0F0F0",text:"#000000"}],defaultAlertSettings:{colour:{enabled:!1,background:"#ff0000",text:"#ffffff",durationMs:1500,intervalMs:500}}},load:function(){var e;S.preferences=JSON.parse(JSON.stringify(S.defaultPreferences));const g=JSON.parse(JSON.stringify(S.schedule));S.alerts={};const y=localStorage.getItem("clockSchedule");let p=!1;if(y)try{const r=JSON.parse(y);Array.isArray(r)&&r.length>0&&(S.schedule=r.map(n=>({label:n.label||"Unnamed",start:n.start||"00:00",end:n.end||"00:00",colourSchemeId:n.colourSchemeId||1,showCircles:typeof n.showCircles=="boolean"?n.showCircles:!1})),p=!0)}catch(r){console.error("Error parsing saved schedule.",r)}p||(S.schedule=g);const w=localStorage.getItem("clockPreferences");if(w)try{const r=JSON.parse(w);if(typeof r=="object"&&r!==null){const n={...JSON.parse(JSON.stringify(S.defaultPreferences)),...r,defaultAlertSettings:{colour:{...S.defaultPreferences.defaultAlertSettings.colour,...((e=r.defaultAlertSettings)==null?void 0:e.colour)||{}}},colourSchemes:r.colourSchemes&&Array.isArray(r.colourSchemes)&&r.colourSchemes.length>0?r.colourSchemes.map(s=>({id:s.id||Date.now()+Math.random(),name:s.name||"Unnamed Scheme",background:s.background||"#000000",text:s.text||"#FFFFFF"})):S.defaultPreferences.colourSchemes};for(const s of["showDate","showTime","showScheduleLabel","showProgressBar","showScheduleCircles","showSandBars"])typeof n[s]!="boolean"&&(n[s]=S.defaultPreferences[s]);for(const s of["dateFontSize","timeFontSize","scheduleLabelFontSize","timeLeftFontSize","progressBarHeight","sandWidth","sandHeight","sandParticleSize"])n[s]=Number(n[s])||S.defaultPreferences[s];n.timeOffsetMs=Number(n.timeOffsetMs)||0,n.sandWidth=Math.max(10,Math.min(100,n.sandWidth)),n.sandHeight=Math.max(50,Math.min(800,n.sandHeight)),n.sandParticleSize=Math.max(1,Math.min(20,n.sandParticleSize)),S.preferences=n}}catch(r){console.error("Error parsing saved preferences.",r)}const l=localStorage.getItem("clockAlerts");if(l)try{const r=JSON.parse(l);typeof r=="object"&&r!==null&&(S.alerts=r,Object.keys(S.alerts).forEach(n=>{var s;(s=S.alerts[n])!=null&&s.noise&&delete S.alerts[n].noise,S.alerts[n]&&typeof S.alerts[n]=="object"&&Object.keys(S.alerts[n]).length===0&&delete S.alerts[n]}))}catch(r){console.error("Error parsing saved alerts settings.",r)}console.log("Settings loaded")},save:function(){try{S.preferences.hasOwnProperty("sandDropInterval")&&delete S.preferences.sandDropInterval;const g={};Object.keys(S.alerts).forEach(p=>{S.alerts[p]&&typeof S.alerts[p]=="object"&&Object.keys(S.alerts[p]).length>0&&(g[p]=S.alerts[p])});const y=S.schedule.map(p=>({label:p.label,start:p.start,end:p.end,colourSchemeId:p.colourSchemeId,showCircles:p.showCircles}));localStorage.setItem("clockSchedule",JSON.stringify(y)),localStorage.setItem("clockPreferences",JSON.stringify(S.preferences)),localStorage.setItem("clockAlerts",JSON.stringify(g))}catch(g){console.error("Error saving settings:",g)}},getActiveColourScheme:function(){var e;const g=se(),y=typeof H<"u"?H.getCurrentPeriodInfo(g):null;let p=1;if(y&&y.index!==void 0&&S.schedule[y.index]){const r=S.schedule[y.index];r.colourSchemeId&&(p=r.colourSchemeId)}const w=((e=S.preferences)==null?void 0:e.colourSchemes)||S.defaultPreferences.colourSchemes;let l=w.find(r=>r.id===p);return l||(l=w.find(r=>r.id===1)),l||(l=w[0]),l||{id:0,name:"Error",background:"#ff00ff",text:"#000000"}}},te={attachListeners:function(){var g,y;(g=T.colorSchemeContentContainer)==null||g.addEventListener("click",te.handleContentClick),(y=T.colorSchemeContentContainer)==null||y.addEventListener("input",te.handleContentInput)},renderTabs:function(){var e;const g=T.colorSchemeTabsContainer,y=T.colorSchemeContentContainer;if(!g||!y)return;g.innerHTML="",(((e=S.preferences)==null?void 0:e.colourSchemes)||[]).forEach((r,n)=>{const s=document.createElement("button");s.className="colour-tab",s.textContent=r.name||`Scheme ${r.id}`,s.dataset.id=r.id,s.dataset.index=n,s.addEventListener("click",function(){g.querySelectorAll(".colour-tab.active").forEach(f=>f.classList.remove("active")),this.classList.add("active"),te.renderContent(n)}),g.appendChild(s)});const w=document.createElement("button");w.className="colour-tab add-colour",w.textContent="+",w.title="Add New Colour Scheme",w.addEventListener("click",te.addScheme),g.appendChild(w);const l=g.querySelector(".colour-tab:not(.add-colour)");l?l.click():y.innerHTML="<p>No colour schemes defined. Click '+' to add one.</p>"},renderContent:function(g){var r;const y=T.colorSchemeContentContainer,p=((r=S.preferences)==null?void 0:r.colourSchemes)||[];if(!y||g<0||g>=p.length)return;const w=p[g];if(!w)return;const l=p.length>1&&w.id!==1&&w.id!==2,e=`
            <button
                id="delete-scheme-${g}"
                data-index="${g}"
                ${l?"":'disabled title="Cannot delete default schemes or the last remaining scheme"'}>
                Delete Scheme
            </button>`;y.innerHTML=`
          <div class="colour-scheme-form">
            <label>Scheme Name: <input type="text" id="scheme-name-${g}" value="${w.name||""}"></label>
            <label>Background Colour: <input type="color" id="scheme-bg-color-${g}" value="${w.background||"#000000"}"></label>
            <label>Main Text Colour (Date, Time, Label, Progress, Active Circles): <input type="color" id="scheme-text-color-${g}" value="${w.text||"#ffffff"}"></label>
            <button id="save-scheme-settings-${g}" data-index="${g}">Save Scheme</button>
            ${l?e:""}
             <div class="feedback-message" style="display: none;"></div>
           </div>`},handleContentInput:function(g){var e;const y=g.target,p=y.closest(".colour-scheme-form");if(!p||!y.id||!(y.id.startsWith("scheme-name")||y.id.startsWith("scheme-bg-color")||y.id.startsWith("scheme-text-color")))return;const w=p.querySelector('button[id^="save-scheme-settings"]');if(!w)return;const l=parseInt(w.dataset.index,10);if(!isNaN(l)&&l>=0&&l<S.preferences.colourSchemes.length){const r=S.preferences.colourSchemes[l];y.id.startsWith("scheme-name")&&(r.name=y.value),y.id.startsWith("scheme-bg-color")&&(r.background=y.value),y.id.startsWith("scheme-text-color")&&(r.text=y.value);const n=(e=T.colorSchemeTabsContainer)==null?void 0:e.querySelector(`.colour-tab[data-index="${l}"]`);n&&y.id.startsWith("scheme-name")&&(n.textContent=y.value||`Scheme ${r.id}`),H.update()}},handleContentClick:function(g){var w,l,e;const y=g.target;if(y.tagName!=="BUTTON"||!y.id||!y.closest(".colour-scheme-form"))return;const p=parseInt(y.dataset.index,10);if((w=y.closest(".colour-scheme-form"))==null||w.querySelector(".feedback-message"),!isNaN(p))if(y.id.startsWith("save-scheme-settings")){S.save(),J.showButtonFeedback(y,"Saved!");const r=(l=T.colorSchemeTabsContainer)==null?void 0:l.querySelector(`.colour-tab[data-index="${p}"]`);r&&!r.classList.contains("active")&&((e=T.colorSchemeTabsContainer)==null||e.querySelectorAll(".colour-tab.active").forEach(n=>n.classList.remove("active")),r.classList.add("active"))}else y.id.startsWith("delete-scheme")&&te.deleteScheme(p,y)},addScheme:function(){var w;const g=(S.preferences.colourSchemes.reduce((l,e)=>Math.max(l,e.id||0),0)||0)+1,y={id:g,name:"New Scheme "+g,background:"#222222",text:"#EEEEEE"};S.preferences.colourSchemes.push(y),S.save(),te.renderTabs();const p=(w=T.colorSchemeTabsContainer)==null?void 0:w.querySelector(`.colour-tab[data-id="${g}"]`);p==null||p.click()},deleteScheme:function(g,y){const p=S.preferences.colourSchemes;if(g<0||g>=p.length)return;const w=p[g];if(p.length>1&&w.id!==1&&w.id!==2){if(confirm(`Delete scheme "${w.name||`Scheme ${g+1}`}"? Periods using it will revert to Scheme 1.`)){const e=w.id;p.splice(g,1),S.schedule.forEach(r=>{r.colourSchemeId===e&&(r.colourSchemeId=1)}),S.save(),$.renderTable(),te.renderTabs(),H.update()}}else alert("Cannot delete default schemes or the last remaining scheme.")},resetDefaults:function(){confirm("Reset ALL Colour Schemes to the defaults? This cannot be undone.")&&(S.preferences.colourSchemes=JSON.parse(JSON.stringify(S.defaultPreferences.colourSchemes)),S.schedule.forEach(g=>g.colourSchemeId=1),S.save(),$.renderTable(),te.renderTabs(),H.update(),J.showButtonFeedback(T.resetSchemesBtn,"Reset!"))}},oe={attachListeners:function(){var g,y,p,w,l;(g=T.fontSelect)==null||g.addEventListener("input",function(){S.preferences&&(S.preferences.fontFamily=this.value,ie.applyFontAndSizePreferences(),S.save())}),document.querySelectorAll(".number-input-wrapper").forEach(e=>{const r=e.querySelector('input[type="number"]'),n=e.querySelector(".num-btn.minus"),s=e.querySelector(".num-btn.plus");if(!r||!r.dataset||!r.dataset.pref||!n||!s)return;const f=r.dataset.pref;let c=null,u=null;const o=500,t=100;if(!S.preferences||!S.defaultPreferences||!S.preferences.hasOwnProperty(f)){console.warn(`Preference key "${f}" not found in settings for input ${r.id}`);return}const i=P=>{if(!S.preferences.hasOwnProperty(f))return;parseInt(r.step);const E=r.min?parseInt(r.min,10):-1/0,B=r.max?parseInt(r.max,10):1/0;let h=parseInt(P,10);if(h=isNaN(h)?S.defaultPreferences[f]:Math.max(E,Math.min(B,h)),S.preferences[f]!==h){if(S.preferences[f]=h,r.value=h,ie.applyFontAndSizePreferences(),["sandWidth","sandHeight","sandParticleSize"].includes(f)){console.log(`Sandbar pref changed (${f}), triggering physics setup...`);const x=H.getCurrentPeriodInfo(se());requestAnimationFrame(()=>{q.setupPhysicsSandBars(x)})}S.save()}},a=P=>{i(parseInt(r.value,10)+P),d(),u=setTimeout(()=>{c=setInterval(()=>{i(parseInt(r.value,10)+P)},t)},o)},d=()=>{clearTimeout(u),clearInterval(c),u=c=null};r.addEventListener("change",()=>i(r.value)),n.addEventListener("mousedown",()=>a(-(parseInt(r.step)||1))),s.addEventListener("mousedown",()=>a(parseInt(r.step)||1)),["mouseup","mouseleave","blur","touchend","touchcancel"].forEach(P=>{n.addEventListener(P,d),s.addEventListener(P,d)})}),(y=T.displayElementsChecklist)==null||y.querySelectorAll('input[type="checkbox"]').forEach(e=>{e.addEventListener("change",oe.handleDisplayToggleChange)}),(p=T.resetAppearanceBtn)==null||p.addEventListener("click",oe.resetFontAndSizeDefaults),(w=T.resetSchemesBtn)==null||w.addEventListener("click",te.resetDefaults),(l=document.getElementById("reset-sandbar-defaults"))==null||l.addEventListener("click",oe.resetSandBarDefaults)},handleDisplayToggleChange:function(){var p,w;const g=this.dataset.pref;if(!g||!S.preferences||!S.preferences.hasOwnProperty(g))return;if(S.preferences[g]=this.checked,g==="showSandBars"&&this.checked&&S.preferences.showProgressBar){S.preferences.showProgressBar=!1;const l=(p=T.displayElementsChecklist)==null?void 0:p.querySelector("#pref-show-progress-bar");l&&(l.checked=!1)}else if(g==="showProgressBar"&&this.checked&&S.preferences.showSandBars){S.preferences.showSandBars=!1;const l=(w=T.displayElementsChecklist)==null?void 0:w.querySelector("#pref-show-sand-bars");l&&(l.checked=!1)}const y=document.getElementById("sand-bar-options");y==null||y.classList.toggle("element-hidden",!S.preferences.showSandBars),ie.update(),q.handleDisplayToggle(),S.save()},updateInputs:function(){var y;if(!S.preferences)return;T.fontSelect&&(T.fontSelect.value=S.preferences.fontFamily),T.dateFontSizeInput&&(T.dateFontSizeInput.value=S.preferences.dateFontSize),T.timeFontSizeInput&&(T.timeFontSizeInput.value=S.preferences.timeFontSize),T.labelFontSizeInput&&(T.labelFontSizeInput.value=S.preferences.scheduleLabelFontSize),T.timeLeftFontSizeInput&&(T.timeLeftFontSizeInput.value=S.preferences.timeLeftFontSize),T.progressHeightInput&&(T.progressHeightInput.value=S.preferences.progressBarHeight),(y=T.displayElementsChecklist)==null||y.querySelectorAll('input[type="checkbox"]').forEach(p=>{const w=p.dataset.pref;w&&S.preferences.hasOwnProperty(w)&&(p.checked=S.preferences[w])});const g=document.getElementById("sand-bar-options");if(g){g.classList.toggle("element-hidden",!S.preferences.showSandBars);const p=g.querySelector("#pref-sand-width"),w=g.querySelector("#pref-sand-height"),l=g.querySelector("#pref-sand-particle-size");p&&(p.value=S.preferences.sandWidth),w&&(w.value=S.preferences.sandHeight),l&&(l.value=S.preferences.sandParticleSize)}},resetFontAndSizeDefaults:function(){if(confirm("Reset Font & Size settings to defaults?")){if(!S.preferences||!S.defaultPreferences)return;S.preferences.fontFamily=S.defaultPreferences.fontFamily,S.preferences.dateFontSize=S.defaultPreferences.dateFontSize,S.preferences.timeFontSize=S.defaultPreferences.timeFontSize,S.preferences.scheduleLabelFontSize=S.defaultPreferences.scheduleLabelFontSize,S.preferences.timeLeftFontSize=S.defaultPreferences.timeLeftFontSize,S.preferences.progressBarHeight=S.defaultPreferences.progressBarHeight,oe.updateInputs(),ie.applyFontAndSizePreferences(),S.save(),J.showButtonFeedback(T.resetAppearanceBtn,"Reset!")}},resetSandBarDefaults:function(){if(confirm("Reset Sand Bar settings to defaults?")){if(!S.preferences||!S.defaultPreferences)return;if(S.preferences.sandWidth=S.defaultPreferences.sandWidth,S.preferences.sandHeight=S.defaultPreferences.sandHeight,S.preferences.sandParticleSize=S.defaultPreferences.sandParticleSize,oe.updateInputs(),S.preferences.showSandBars){const g=H.getCurrentPeriodInfo(se());requestAnimationFrame(()=>{q.setupPhysicsSandBars(g)})}S.save(),J.showButtonFeedback(document.getElementById("reset-sandbar-defaults"),"Reset!")}}},_={attachListeners:function(){var g,y;(g=T.syncToBellBtn)==null||g.addEventListener("click",_.syncToNearestBell),(y=T.resetOffsetBtn)==null||y.addEventListener("click",_.resetOffset),_.addManualOffsetListener(T.offsetMinDownBtn,-6e4),_.addManualOffsetListener(T.offsetMinUpBtn,6e4),_.addManualOffsetListener(T.offsetSecDownBtn,-1e3),_.addManualOffsetListener(T.offsetSecUpBtn,1e3)},addManualOffsetListener:function(g,y){g&&g.addEventListener("click",()=>_.adjustOffset(y))},adjustOffset:function(g){typeof S.preferences.timeOffsetMs!="number"&&(S.preferences.timeOffsetMs=0),S.preferences.timeOffsetMs+=g,_.updateOffsetDisplay(),H.update(),S.save()},resetOffset:function(){S.preferences.timeOffsetMs!==0?(S.preferences.timeOffsetMs=0,_.updateOffsetDisplay(),H.update(),S.save(),J.showButtonFeedback(T.resetOffsetBtn,"Offset Reset!",1500)):J.showButtonFeedback(T.resetOffsetBtn,"Already Zero!",1e3)},syncToNearestBell:function(){if(!S.schedule||S.schedule.length===0){J.showButtonFeedback(T.syncToBellBtn,"Add Schedule First!",2e3);return}const y=new Date().getTime();let p=1/0,w=null;if(S.schedule.forEach(l=>{if(!(!l||!l.start||!l.end||!/^\d{2}:\d{2}$/.test(l.start)||!/^\d{2}:\d{2}$/.test(l.end)))try{const e=J.getTodayTime(l.start),r=J.getTodayTime(l.end),n=e.getTime(),s=r.getTime();let f=Math.abs(n-y);if(f<p&&(p=f,w=e),!S.schedule.some(u=>u.start===l.end)){let u=Math.abs(s-y);u<p&&(p=u,w=r)}}catch(e){console.error("Sync error parsing time for period:",l.label,e)}}),w!==null){const l=w.getTime()-y;S.preferences.timeOffsetMs=l,_.updateOffsetDisplay(),H.update(),S.save(),J.showButtonFeedback(T.syncToBellBtn,"Synced!")}else J.showButtonFeedback(T.syncToBellBtn,"No Valid Times!",2e3)},updateOffsetDisplay:function(){var s;const g=Number((s=S.preferences)==null?void 0:s.timeOffsetMs)||0,y=Math.round(g/1e3),p=y>=0?"+":"-",w=Math.abs(y),l=Math.floor(w/60),e=w%60,r=e<10?"0"+e:e,n=`${p}${l}m ${r}s`;T.currentOffsetDisplay&&(T.currentOffsetDisplay.textContent=n)}},ae={init:function(){console.log("Classroom Clock Initializing..."),Le(),S.load(),oe.updateInputs(),te.renderTabs(),$.renderTable(),_.updateOffsetDisplay(),oe.attachListeners(),te.attachListeners(),$.attachListeners(),Q.attachListeners(),_.attachListeners(),ae.attachGlobalListeners(),ie.update(),q.handleDisplayToggle(),H.start(),console.log("Classroom Clock Initialized.")},attachGlobalListeners:function(){var g,y,p;(g=T.menuToggle)==null||g.addEventListener("click",()=>{var l;const w=(l=T.settingsMenu)==null?void 0:l.classList.toggle("open");T.menuToggle&&(T.menuToggle.innerHTML=w?"▲":"▼")}),(y=T.menuResizer)==null||y.addEventListener("mousedown",ae.handleResizeMouseDown),document.addEventListener("mousemove",ae.handleResizeMouseMove),document.addEventListener("mouseup",ae.handleResizeMouseUp),document.addEventListener("mouseleave",ae.handleResizeMouseUp),(p=T.tabsContainer)==null||p.querySelectorAll(".tab-button").forEach(w=>{w.addEventListener("click",ae.handleTabClick)})},handleTabClick:function(){if(!T.tabsContainer||!T.tabContentsContainer)return;T.tabsContainer.querySelectorAll(".tab-button.active").forEach(y=>y.classList.remove("active")),T.tabContentsContainer.querySelectorAll(".tab-content.active").forEach(y=>y.classList.remove("active")),this.classList.add("active");const g=this.getAttribute("data-tab");if(g){const y=T.tabContentsContainer.querySelector(`#${g}`);y&&y.classList.add("active")}},handleResizeMouseDown:function(g){R.isResizingMenu=!0,document.body.style.cursor="ew-resize",document.body.style.userSelect="none",document.body.style.setProperty("-webkit-user-select","none")},handleResizeMouseMove:function(g){if(!R.isResizingMenu||!T.settingsMenu)return;const y=window.innerWidth-g.clientX,p=400,w=Math.min(950,window.innerWidth-50);y>=p&&y<=w&&(T.settingsMenu.style.width=y+"px")},handleResizeMouseUp:function(g){R.isResizingMenu&&(R.isResizingMenu=!1,document.body.style.cursor="default",document.body.style.userSelect="",document.body.style.removeProperty("-webkit-user-select"))}};document.addEventListener("DOMContentLoaded",ae.init);
